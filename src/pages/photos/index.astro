---
import { getCollection } from 'astro:content'
import PageLayout from '@/layouts/CommonPage.astro'

const title = 'Photos'

// Fetch photos from Content Collections
const photos = (await getCollection('photos')).sort((a, b) => {
  // Sort by ID (filename) numerically
  return parseInt(a.data.id) - parseInt(b.data.id)
})
---

<PageLayout {title}>
  <div class='mx-auto max-w-screen-xl px-4 py-8'>
    <!-- Photo Grid (Masonry) -->
    <div class='columns-1 gap-4 sm:columns-2 lg:columns-3 space-y-4'>
      {
        photos.map((photo, index) => (
          <article
            class='group break-inside-avoid mb-4'
            style={`animation-delay: ${index * 50}ms`}
          >
            <div class='relative overflow-hidden rounded-lg bg-muted shadow-sm transition-all duration-300 hover:-translate-y-1 hover:shadow-md'>
              <img
                src={photo.data.src}
                alt={photo.data.alt || photo.data.title}
                title={photo.data.title}
                loading='lazy'
                class='zoomable w-full h-auto object-cover transition-transform duration-500 group-hover:scale-105'
              />
              <div class='absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/60 to-transparent p-4 opacity-0 transition-opacity duration-300 group-hover:opacity-100'>
                <h2 class='text-sm font-medium text-white'>{photo.data.title}</h2>
              </div>
            </div>
          </article>
        ))
      }
    </div>

    <!-- Empty State -->
    {
      photos.length === 0 && (
        <div class='text-center py-16'>
          <p class='text-muted-foreground text-lg'>暂无照片，敬请期待...</p>
        </div>
      )
    }
  </div>
</PageLayout>

<style>
  /* Entry Animation */
  article {
    animation: fade-up 0.6s ease-out backwards;
  }

  @keyframes fade-up {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Ensure medium-zoom works */
  .zoomable {
    cursor: zoom-in;
  }
</style>
