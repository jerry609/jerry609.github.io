---
import PageLayout from '@/layouts/CommonPage.astro'

type Topic = {
  title: string
  prerequisites: { name: string; course: string }[]
  problems: { name: string; difficulty: string; link: string }[]
}

const topics: Record<string, Topic> = {
  'arrays-hashing': {
    title: 'Arrays & Hashing',
    prerequisites: [
      { name: 'Dynamic Arrays', course: 'DSA for Beginners' },
      { name: 'Hash Tables', course: 'DSA for Beginners' }
    ],
    problems: [
      { name: 'Contains Duplicate', difficulty: 'Easy', link: 'https://leetcode.com/problems/contains-duplicate/' },
      { name: 'Valid Anagram', difficulty: 'Easy', link: 'https://leetcode.com/problems/valid-anagram/' },
      { name: 'Two Sum', difficulty: 'Easy', link: 'https://leetcode.com/problems/two-sum/' },
      { name: 'Group Anagrams', difficulty: 'Medium', link: 'https://leetcode.com/problems/group-anagrams/' },
      { name: 'Top K Frequent Elements', difficulty: 'Medium', link: 'https://leetcode.com/problems/top-k-frequent-elements/' },
      { name: 'Product of Array Except Self', difficulty: 'Medium', link: 'https://leetcode.com/problems/product-of-array-except-self/' },
      { name: 'Valid Sudoku', difficulty: 'Medium', link: 'https://leetcode.com/problems/valid-sudoku/' },
      { name: 'Longest Consecutive Sequence', difficulty: 'Medium', link: 'https://leetcode.com/problems/longest-consecutive-sequence/' }
    ]
  },
  'two-pointers': {
    title: 'Two Pointers',
    prerequisites: [{ name: 'Pointer Techniques', course: 'DSA for Beginners' }],
    problems: [
      { name: 'Valid Palindrome', difficulty: 'Easy', link: 'https://leetcode.com/problems/valid-palindrome/' },
      { name: 'Two Sum II', difficulty: 'Medium', link: 'https://leetcode.com/problems/two-sum-ii-input-array-is-sorted/' },
      { name: '3Sum', difficulty: 'Medium', link: 'https://leetcode.com/problems/3sum/' },
      { name: 'Container With Most Water', difficulty: 'Medium', link: 'https://leetcode.com/problems/container-with-most-water/' },
      { name: 'Trapping Rain Water', difficulty: 'Hard', link: 'https://leetcode.com/problems/trapping-rain-water/' }
    ]
  },
  'stack': {
    title: 'Stack',
    prerequisites: [{ name: 'Call Stack', course: 'DSA for Beginners' }],
    problems: [
      { name: 'Valid Parentheses', difficulty: 'Easy', link: 'https://leetcode.com/problems/valid-parentheses/' },
      { name: 'Min Stack', difficulty: 'Medium', link: 'https://leetcode.com/problems/min-stack/' },
      { name: 'Daily Temperatures', difficulty: 'Medium', link: 'https://leetcode.com/problems/daily-temperatures/' },
      { name: 'Largest Rectangle in Histogram', difficulty: 'Hard', link: 'https://leetcode.com/problems/largest-rectangle-in-histogram/' }
    ]
  },
  'binary-search': {
    title: 'Binary Search',
    prerequisites: [{ name: 'Sorted Arrays', course: 'DSA for Beginners' }],
    problems: [
      { name: 'Binary Search', difficulty: 'Easy', link: 'https://leetcode.com/problems/binary-search/' },
      { name: 'Search 2D Matrix', difficulty: 'Medium', link: 'https://leetcode.com/problems/search-a-2d-matrix/' },
      { name: 'Koko Eating Bananas', difficulty: 'Medium', link: 'https://leetcode.com/problems/koko-eating-bananas/' },
      { name: 'Median of Two Sorted Arrays', difficulty: 'Hard', link: 'https://leetcode.com/problems/median-of-two-sorted-arrays/' }
    ]
  },
  'sliding-window': {
    title: 'Sliding Window',
    prerequisites: [{ name: 'Window Basics', course: 'Advanced Algorithms' }],
    problems: [
      { name: 'Best Time to Buy and Sell Stock', difficulty: 'Easy', link: 'https://leetcode.com/problems/best-time-to-buy-and-sell-stock/' },
      { name: 'Longest Substring Without Repeating', difficulty: 'Medium', link: 'https://leetcode.com/problems/longest-substring-without-repeating-characters/' },
      { name: 'Minimum Window Substring', difficulty: 'Hard', link: 'https://leetcode.com/problems/minimum-window-substring/' }
    ]
  },
  'linked-list': {
    title: 'Linked List',
    prerequisites: [{ name: 'Pointers', course: 'DSA for Beginners' }],
    problems: [
      { name: 'Reverse Linked List', difficulty: 'Easy', link: 'https://leetcode.com/problems/reverse-linked-list/' },
      { name: 'Linked List Cycle', difficulty: 'Easy', link: 'https://leetcode.com/problems/linked-list-cycle/' },
      { name: 'Reorder List', difficulty: 'Medium', link: 'https://leetcode.com/problems/reorder-list/' },
      { name: 'LRU Cache', difficulty: 'Medium', link: 'https://leetcode.com/problems/lru-cache/' },
      { name: 'Merge K Sorted Lists', difficulty: 'Hard', link: 'https://leetcode.com/problems/merge-k-sorted-lists/' }
    ]
  },
  'trees': {
    title: 'Trees',
    prerequisites: [{ name: 'DFS / BFS', course: 'DSA for Beginners' }],
    problems: [
      { name: 'Invert Binary Tree', difficulty: 'Easy', link: 'https://leetcode.com/problems/invert-binary-tree/' },
      { name: 'Validate BST', difficulty: 'Medium', link: 'https://leetcode.com/problems/validate-binary-search-tree/' },
      { name: 'Binary Tree Maximum Path Sum', difficulty: 'Hard', link: 'https://leetcode.com/problems/binary-tree-maximum-path-sum/' }
    ]
  },
  'tries': {
    title: 'Tries',
    prerequisites: [{ name: 'Prefix Trees', course: 'Advanced Algorithms' }],
    problems: [
      { name: 'Implement Trie', difficulty: 'Medium', link: 'https://leetcode.com/problems/implement-trie-prefix-tree/' },
      { name: 'Word Search II', difficulty: 'Hard', link: 'https://leetcode.com/problems/word-search-ii/' }
    ]
  },
  'heap': {
    title: 'Heap / Priority Queue',
    prerequisites: [{ name: 'Binary Heap', course: 'DSA for Beginners' }],
    problems: [
      { name: 'K Closest Points', difficulty: 'Medium', link: 'https://leetcode.com/problems/k-closest-points-to-origin/' },
      { name: 'Find Median from Data Stream', difficulty: 'Hard', link: 'https://leetcode.com/problems/find-median-from-data-stream/' }
    ]
  },
  'backtracking': {
    title: 'Backtracking',
    prerequisites: [{ name: 'Subsets & Permutations', course: 'Advanced Algorithms' }],
    problems: [
      { name: 'Subsets', difficulty: 'Medium', link: 'https://leetcode.com/problems/subsets/' },
      { name: 'Combination Sum', difficulty: 'Medium', link: 'https://leetcode.com/problems/combination-sum/' },
      { name: 'N-Queens', difficulty: 'Hard', link: 'https://leetcode.com/problems/n-queens/' }
    ]
  },
  'graphs': {
    title: 'Graphs',
    prerequisites: [{ name: 'Adjacency List', course: 'DSA for Beginners' }],
    problems: [
      { name: 'Number of Islands', difficulty: 'Medium', link: 'https://leetcode.com/problems/number-of-islands/' },
      { name: 'Course Schedule', difficulty: 'Medium', link: 'https://leetcode.com/problems/course-schedule/' },
      { name: 'Word Ladder', difficulty: 'Hard', link: 'https://leetcode.com/problems/word-ladder/' }
    ]
  },
  '1d-dp': {
    title: '1-D DP',
    prerequisites: [{ name: 'Memoization', course: 'Advanced Algorithms' }],
    problems: [
      { name: 'Climbing Stairs', difficulty: 'Easy', link: 'https://leetcode.com/problems/climbing-stairs/' },
      { name: 'House Robber', difficulty: 'Medium', link: 'https://leetcode.com/problems/house-robber/' },
      { name: 'Longest Increasing Subsequence', difficulty: 'Medium', link: 'https://leetcode.com/problems/longest-increasing-subsequence/' }
    ]
  },
  'intervals': {
    title: 'Intervals',
    prerequisites: [{ name: 'Sorting', course: 'Advanced Algorithms' }],
    problems: [
      { name: 'Merge Intervals', difficulty: 'Medium', link: 'https://leetcode.com/problems/merge-intervals/' },
      { name: 'Meeting Rooms II', difficulty: 'Medium', link: 'https://leetcode.com/problems/meeting-rooms-ii/' }
    ]
  },
  'greedy': {
    title: 'Greedy',
    prerequisites: [{ name: 'Greedy Strategy', course: 'Advanced Algorithms' }],
    problems: [
      { name: 'Jump Game', difficulty: 'Medium', link: 'https://leetcode.com/problems/jump-game/' },
      { name: 'Gas Station', difficulty: 'Medium', link: 'https://leetcode.com/problems/gas-station/' }
    ]
  },
  'advanced-graphs': {
    title: 'Advanced Graphs',
    prerequisites: [{ name: 'Dijkstra', course: 'Advanced Algorithms' }],
    problems: [
      { name: 'Network Delay Time', difficulty: 'Medium', link: 'https://leetcode.com/problems/network-delay-time/' },
      { name: 'Swim in Rising Water', difficulty: 'Hard', link: 'https://leetcode.com/problems/swim-in-rising-water/' }
    ]
  },
  '2d-dp': {
    title: '2-D DP',
    prerequisites: [{ name: 'Knapsack', course: 'Advanced Algorithms' }],
    problems: [
      { name: 'Unique Paths', difficulty: 'Medium', link: 'https://leetcode.com/problems/unique-paths/' },
      { name: 'Edit Distance', difficulty: 'Hard', link: 'https://leetcode.com/problems/edit-distance/' }
    ]
  },
  'bit-manipulation': {
    title: 'Bit Manipulation',
    prerequisites: [{ name: 'Bitwise Ops', course: 'Advanced Algorithms' }],
    problems: [
      { name: 'Single Number', difficulty: 'Easy', link: 'https://leetcode.com/problems/single-number/' },
      { name: 'Reverse Integer', difficulty: 'Medium', link: 'https://leetcode.com/problems/reverse-integer/' }
    ]
  },
  'math-geometry': {
    title: 'Math & Geometry',
    prerequisites: [{ name: 'Matrix Ops', course: 'Advanced Algorithms' }],
    problems: [
      { name: 'Rotate Image', difficulty: 'Medium', link: 'https://leetcode.com/problems/rotate-image/' },
      { name: 'Spiral Matrix', difficulty: 'Medium', link: 'https://leetcode.com/problems/spiral-matrix/' }
    ]
  }
}

const nodes = [
  { id: 'arrays-hashing', x: 400, y: 30 },
  { id: 'two-pointers', x: 180, y: 180 },
  { id: 'stack', x: 620, y: 180 },
  { id: 'binary-search', x: 50, y: 330 },
  { id: 'sliding-window', x: 400, y: 330 },
  { id: 'linked-list', x: 750, y: 330 },
  { id: 'trees', x: 400, y: 480 },
  { id: 'tries', x: 150, y: 630 },
  { id: 'backtracking', x: 650, y: 630 },
  { id: 'heap', x: 50, y: 780 },
  { id: 'graphs', x: 400, y: 780 },
  { id: '1d-dp', x: 750, y: 780 },
  { id: 'intervals', x: 50, y: 930 },
  { id: 'greedy', x: 230, y: 930 },
  { id: 'advanced-graphs', x: 410, y: 930 },
  { id: '2d-dp', x: 590, y: 930 },
  { id: 'bit-manipulation', x: 770, y: 930 },
  { id: 'math-geometry', x: 590, y: 1080 }
]

const edges = [
  ['arrays-hashing', 'two-pointers'],
  ['arrays-hashing', 'stack'],
  ['two-pointers', 'binary-search'],
  ['two-pointers', 'sliding-window'],
  ['stack', 'sliding-window'],
  ['stack', 'linked-list'],
  ['binary-search', 'trees'],
  ['sliding-window', 'trees'],
  ['linked-list', 'trees'],
  ['trees', 'tries'],
  ['trees', 'backtracking'],
  ['tries', 'heap'],
  ['backtracking', 'graphs'],
  ['backtracking', '1d-dp'],
  ['heap', 'intervals'],
  ['heap', 'greedy'],
  ['heap', 'advanced-graphs'],
  ['graphs', 'advanced-graphs'],
  ['graphs', '2d-dp'],
  ['1d-dp', '2d-dp'],
  ['1d-dp', 'bit-manipulation'],
  ['2d-dp', 'math-geometry']
]

const headings = [{ depth: 2, slug: 'roadmap', text: 'Algorithm Roadmap' }]
---

<PageLayout title='Algorithm Roadmap' {headings}>
  <p class='mb-6 text-muted-foreground'>
    点击节点查看题目列表，参考
    <a href='https://neetcode.io/roadmap' target='_blank' class='text-primary hover:underline'>NeetCode</a>。
  </p>

  <div class='roadmap-container'>
    <!-- Mini-map and controls -->
    <div class='roadmap-controls'>
      <div class='mini-map'>
        <svg class='mini-map-svg' viewBox='0 0 1000 1200' xmlns='http://www.w3.org/2000/svg'>
          {edges.map(([from, to]) => {
            const a = nodes.find(n => n.id === from)
            const b = nodes.find(n => n.id === to)
            if (!a || !b) return null
            const rectW = 180, rectH = 64
            const x1 = a.x + rectW / 2, y1 = a.y + rectH / 2
            const x2 = b.x + rectW / 2, y2 = b.y
            return <line x1={x1} y1={y1} x2={x2} y2={y2} stroke='#475569' stroke-width='6' />
          })}
          {nodes.map(n => (
            <rect x={n.x} y={n.y} width='180' height='64' rx='8' fill='#334155' stroke='#60a5fa' stroke-width='4' />
          ))}
          <rect id='mini-viewport' class='mini-viewport' x='0' y='0' width='1000' height='900' fill='rgba(96, 165, 250, 0.15)' stroke='#60a5fa' stroke-width='8' />
        </svg>
      </div>
      <button id='reset-btn' class='reset-btn' title='Reset View'>
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
        <span>Reset</span>
      </button>
      <div class='zoom-info' id='zoom-info'>100%</div>
    </div>

    <div class='roadmap-box'>
      <svg class='roadmap-svg' viewBox='0 0 1000 1200' xmlns='http://www.w3.org/2000/svg'>
        <g id='canvas' transform='translate(0,0) scale(1)'>
        {edges.map(([from, to]) => {
          const a = nodes.find(n => n.id === from)
          const b = nodes.find(n => n.id === to)
          if (!a || !b) return null
          const rectW = 180, rectH = 64
          const x1 = a.x + rectW / 2, y1 = a.y + rectH / 2
          const x2 = b.x + rectW / 2, y2 = b.y
          const cy = (y1 + y2) / 2
          return <path d={`M${x1} ${y1} C${x1} ${cy}, ${x2} ${cy}, ${x2} ${y2}`} class='edge-line' />
        })}
        {nodes.map(n => (
          <g class='node-box' data-id={n.id} transform={`translate(${n.x},${n.y})`}>
            <rect width='180' height='64' rx='12' />
            <text x='90' y='38'>{topics[n.id].title}</text>
          </g>
        ))}
      </g>
    </svg>
  </div>
</div>

  <div id='modal' class='modal hidden'>
    <div class='modal-inner'>
      <button id='close-btn' class='close-btn'>
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
      </button>
      <h2 id='modal-title'></h2>
      <p id='modal-count' class='count-text'></p>
      <div class='bar-track'><div id='bar-fill' class='bar-fill'></div></div>
      <h3>Prerequisites</h3>
      <div id='prereq-box' class='prereq-box'></div>
      <h3>Problems</h3>
      <div class='prob-list' id='prob-body'></div>
    </div>
  </div>
</PageLayout>

<script define:vars={{ topics }}>
  document.addEventListener('DOMContentLoaded', () => {
    const modal = document.getElementById('modal')
    const closeBtn = document.getElementById('close-btn')
    const titleEl = document.getElementById('modal-title')
    const countEl = document.getElementById('modal-count')
    const barFill = document.getElementById('bar-fill')
        const prereqBox = document.getElementById('prereq-box')
        const probBody = document.getElementById('prob-body')

        // LocalStorage Key
        const STORAGE_KEY = 'algo-roadmap-progress'
        let progress = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}')

        function save() {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(progress))
        }

        function updateProgress(topicId) {
          const total = topics[topicId].problems.length
          const completed = topics[topicId].problems.filter(p => progress[p.link]).length
          const percent = total === 0 ? 0 : Math.round((completed / total) * 100)
      
          countEl.textContent = `${completed} / ${total} (${percent}%)`
          barFill.style.width = `${percent}%`
        }

        function open(id) {
          const d = topics[id]
          if (!d) return
      
          modal.dataset.activeTopic = id
          titleEl.textContent = d.title
      
          prereqBox.innerHTML = d.prerequisites.map(p => 
            `<div class='prereq-card'><b>${p.name}</b><small>${p.course}</small></div>`
          ).join('')
      
          probBody.innerHTML = d.problems.map(p => {
            const isChecked = progress[p.link] ? 'checked' : ''
            return `
            <div class='prob-item'>
              <input type='checkbox' class='prob-check' data-link='${p.link}' ${isChecked}/>
              <a href='${p.link}' target='_blank' class='prob-name'>${p.name}</a>
              <span class='diff diff-${p.difficulty.toLowerCase()}'>${p.difficulty}</span>
            </div>
          `}).join('')
      
          updateProgress(id)
          modal.classList.remove('hidden')
        }

        // Event Delegation for Checkboxes
        probBody.addEventListener('change', (e) => {
          if (e.target.classList.contains('prob-check')) {
            const link = e.target.dataset.link
            if (e.target.checked) {
              progress[link] = true
            } else {
              delete progress[link]
            }
            save()
            updateProgress(modal.dataset.activeTopic)
          }
        })

        document.querySelectorAll('.node-box').forEach(el => {
          el.addEventListener('click', (evt) => {
            // stop propagation to avoid triggering panning
            evt.stopPropagation()
            open(el.dataset.id)
          })
        })

        // Panning / Dragging the canvas
        const svg = document.querySelector('.roadmap-svg')
        const canvas = document.getElementById('canvas')
        const miniViewport = document.getElementById('mini-viewport')
        const resetBtn = document.getElementById('reset-btn')
        const zoomInfo = document.getElementById('zoom-info')
        
        let isPanning = false
        let startX = 0, startY = 0
        let panX = 0, panY = 0
        let scale = 1
        const minScale = 0.3, maxScale = 2.5

        function updateTransform() {
          canvas.setAttribute('transform', `translate(${panX},${panY}) scale(${scale})`)
          zoomInfo.textContent = `${Math.round(scale * 100)}%`
          updateMiniMap()
        }

        function updateMiniMap() {
          if (!miniViewport) return
          // viewport in SVG coordinates
          const vw = 1000 / scale
          const vh = 1200 / scale
          const vx = -panX / scale
          const vy = -panY / scale
          miniViewport.setAttribute('x', vx)
          miniViewport.setAttribute('y', vy)
          miniViewport.setAttribute('width', vw)
          miniViewport.setAttribute('height', vh)
        }

        function resetView() {
          panX = 0
          panY = 0
          scale = 1
          updateTransform()
        }

        resetBtn.addEventListener('click', resetView)

        svg.style.cursor = 'grab'

        svg.addEventListener('mousedown', (e) => {
          if (e.button !== 0) return
          // prevent panning when clicking node (nodes stopPropagation above)
          isPanning = true
          startX = e.clientX
          startY = e.clientY
          svg.style.cursor = 'grabbing'
        })

        document.addEventListener('mousemove', (e) => {
          if (!isPanning) return
          const dx = e.clientX - startX
          const dy = e.clientY - startY
          canvas.setAttribute('transform', `translate(${panX + dx},${panY + dy}) scale(${scale})`)
          updateMiniMap()
        })

        document.addEventListener('mouseup', (e) => {
          if (!isPanning) return
          const dx = e.clientX - startX
          const dy = e.clientY - startY
          panX += dx
          panY += dy
          isPanning = false
          svg.style.cursor = 'grab'
          updateMiniMap()
        })

        // Zoom with Ctrl+Wheel
        svg.addEventListener('wheel', (e) => {
          if (!e.ctrlKey) return
          e.preventDefault()
          const rect = svg.getBoundingClientRect()
          const mouseX = e.clientX - rect.left
          const mouseY = e.clientY - rect.top
          
          // Convert mouse position to SVG coordinates
          const svgX = (mouseX / rect.width) * 1000
          const svgY = (mouseY / rect.height) * 1200
          
          const oldScale = scale
          const delta = e.deltaY > 0 ? 0.9 : 1.1
          scale = Math.min(maxScale, Math.max(minScale, scale * delta))
          
          // Adjust pan to zoom towards mouse position
          panX = panX - (svgX - panX / oldScale) * (scale - oldScale)
          panY = panY - (svgY - panY / oldScale) * (scale - oldScale)
          
          updateTransform()
        }, { passive: false })

        // Touch support
        // Touch support for panning and pinch-zoom
        let lastTouchDist = 0
        let lastTouchCenter = { x: 0, y: 0 }
        
        svg.addEventListener('touchstart', (e) => {
          if (e.touches.length === 1) {
            isPanning = true
            startX = e.touches[0].clientX
            startY = e.touches[0].clientY
          } else if (e.touches.length === 2) {
            isPanning = false
            const t1 = e.touches[0], t2 = e.touches[1]
            lastTouchDist = Math.hypot(t2.clientX - t1.clientX, t2.clientY - t1.clientY)
            lastTouchCenter = { x: (t1.clientX + t2.clientX) / 2, y: (t1.clientY + t2.clientY) / 2 }
          }
        }, { passive: true })

        document.addEventListener('touchmove', (e) => {
          if (e.touches.length === 1 && isPanning) {
            const dx = e.touches[0].clientX - startX
            const dy = e.touches[0].clientY - startY
            canvas.setAttribute('transform', `translate(${panX + dx},${panY + dy}) scale(${scale})`)
            updateMiniMap()
          } else if (e.touches.length === 2) {
            const t1 = e.touches[0], t2 = e.touches[1]
            const dist = Math.hypot(t2.clientX - t1.clientX, t2.clientY - t1.clientY)
            const center = { x: (t1.clientX + t2.clientX) / 2, y: (t1.clientY + t2.clientY) / 2 }
            
            // Pinch zoom
            if (lastTouchDist > 0) {
              const delta = dist / lastTouchDist
              const oldScale = scale
              scale = Math.min(maxScale, Math.max(minScale, scale * delta))
              
              // Pan while zooming
              const dx = center.x - lastTouchCenter.x
              const dy = center.y - lastTouchCenter.y
              panX += dx
              panY += dy
              
              updateTransform()
            }
            lastTouchDist = dist
            lastTouchCenter = center
          }
        }, { passive: true })

        document.addEventListener('touchend', (e) => {
          if (e.touches.length < 2) {
            lastTouchDist = 0
          }
          if (e.touches.length === 0 && isPanning) {
            // Finalize panning
            const matrix = canvas.getAttribute('transform') || 'translate(0,0) scale(1)'
            const m = matrix.match(/translate\(([-0-9.]+),([-0-9.]+)\)/)
            if (m) { panX = parseFloat(m[1]); panY = parseFloat(m[2]) }
            isPanning = false
          }
        })

        function close() { modal.classList.add('hidden') }
        closeBtn.addEventListener('click', close)
        modal.addEventListener('click', e => { if (e.target === modal) close() })
        document.addEventListener('keydown', e => { if (e.key === 'Escape') close() })
      })
    </script>
<style>
  /* Roadmap Container */
  .roadmap-container {
    position: relative;
  }

  .roadmap-controls {
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    z-index: 10;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    align-items: flex-end;
  }

  .mini-map {
    width: 150px;
    height: 180px;
    background: hsl(var(--card));
    border: 1px solid hsl(var(--border));
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
  }

  .mini-map-svg {
    width: 100%;
    height: 100%;
    background: hsl(var(--muted));
  }

  .mini-viewport {
    pointer-events: none;
  }

  .reset-btn {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    padding: 0.5rem 0.75rem;
    background: hsl(var(--primary));
    color: hsl(var(--primary-foreground));
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.85rem;
    font-weight: 500;
    transition: opacity 0.2s;
  }
  .reset-btn:hover { opacity: 0.85; }

  .zoom-info {
    background: hsl(var(--muted));
    color: hsl(var(--muted-foreground));
    padding: 0.3rem 0.6rem;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 600;
    border: 1px solid hsl(var(--border));
  }

  /* Roadmap Box */
  .roadmap-box {
    border-radius: 12px;
    background: linear-gradient(135deg, hsl(var(--muted)) 0%, hsl(var(--card)) 100%);
    border: 1px solid hsl(var(--border));
    overflow: hidden;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
  }

  .roadmap-svg {
    width: 100%;
    height: 600px;
    display: block;
    touch-action: none;
    user-select: none;
  }

  /* Edge Lines */
  .edge-line {
    stroke: hsl(var(--muted-foreground) / 0.4);
    stroke-width: 2.5;
    fill: none;
  }

  /* Node Boxes */
  .node-box rect {
    fill: hsl(var(--card));
    stroke: hsl(var(--primary));
    stroke-width: 2;
    transition: all 0.2s ease;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.15));
  }
  .node-box:hover rect {
    fill: hsl(var(--primary) / 0.15);
    stroke-width: 3;
    filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.25));
  }
  .node-box {
    cursor: pointer;
  }
  .node-box text {
    fill: hsl(var(--foreground));
    font-size: 14px;
    font-weight: 600;
    text-anchor: middle;
    dominant-baseline: middle;
    pointer-events: none;
  }

  /* Modal */
  .modal {
    position: fixed;
    inset: 0;
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(4px);
    padding: 1rem;
  }
  .modal.hidden { display: none; }

  .modal-inner {
    background: hsl(var(--card));
    border: 1px solid hsl(var(--border));
    border-radius: 16px;
    max-width: 700px;
    width: 100%;
    max-height: 85vh;
    overflow-y: auto;
    padding: 1.5rem 2rem;
    position: relative;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  }

  .close-btn {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: hsl(var(--muted));
    border: none;
    border-radius: 50%;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: hsl(var(--muted-foreground));
    transition: all 0.2s;
  }
  .close-btn:hover {
    background: hsl(var(--destructive));
    color: hsl(var(--destructive-foreground));
  }

  .modal-inner h2 {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    color: hsl(var(--foreground));
  }

  .modal-inner h3 {
    font-size: 1rem;
    font-weight: 600;
    margin: 1.25rem 0 0.5rem;
    color: hsl(var(--muted-foreground));
  }

  .count-text {
    color: hsl(var(--muted-foreground));
    font-size: 0.9rem;
    margin-bottom: 0.75rem;
  }

  .bar-track {
    width: 100%;
    height: 8px;
    background: hsl(var(--muted));
    border-radius: 4px;
    overflow: hidden;
  }
  .bar-fill {
    height: 100%;
    background: linear-gradient(90deg, #22c55e, #4ade80);
    border-radius: 4px;
    transition: width 0.3s ease;
  }

  .prereq-box {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }
  .prereq-card {
    background: hsl(var(--muted));
    border: 1px solid hsl(var(--border));
    border-radius: 8px;
    padding: 0.5rem 0.75rem;
    display: flex;
    flex-direction: column;
    gap: 0.15rem;
  }
  .prereq-card b {
    font-size: 0.9rem;
    color: hsl(var(--foreground));
  }
  .prereq-card small {
    font-size: 0.75rem;
    color: hsl(var(--muted-foreground));
  }

  /* Problem List */
  .prob-list {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .prob-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    background: hsl(var(--muted));
    border: 1px solid hsl(var(--border));
    border-radius: 10px;
    transition: all 0.2s;
  }
  .prob-item:hover {
    background: hsl(var(--muted) / 0.7);
    border-color: hsl(var(--primary) / 0.3);
  }

  .prob-name {
    flex: 1;
    color: hsl(var(--primary));
    text-decoration: none;
    font-weight: 500;
    font-size: 0.95rem;
    transition: color 0.2s;
  }
  .prob-name:hover {
    color: hsl(var(--primary) / 0.8);
    text-decoration: underline;
  }

  .diff {
    font-size: 0.75rem;
    font-weight: 700;
    padding: 0.25rem 0.6rem;
    border-radius: 9999px;
    display: inline-block;
    text-align: center;
    min-width: 60px;
    flex-shrink: 0;
  }
  .diff-easy { color: #22c55e; background: rgba(34, 197, 94, 0.15); border: 1px solid rgba(34, 197, 94, 0.2); }
  .diff-medium { color: #eab308; background: rgba(234, 179, 8, 0.15); border: 1px solid rgba(234, 179, 8, 0.2); }
  .diff-hard { color: #ef4444; background: rgba(239, 68, 68, 0.15); border: 1px solid rgba(239, 68, 68, 0.2); }
  
  /* Custom Checkbox */
  input[type='checkbox'] {
    appearance: none;
    width: 1.25rem;
    height: 1.25rem;
    border: 2px solid hsl(var(--muted-foreground));
    border-radius: 5px;
    background: hsl(var(--card));
    cursor: pointer;
    position: relative;
    transition: all 0.2s;
    flex-shrink: 0;
  }
  input[type='checkbox']:checked {
    background: #22c55e;
    border-color: #22c55e;
  }
  input[type='checkbox']:checked::after {
    content: '';
    position: absolute;
    left: 5px;
    top: 1px;
    width: 5px;
    height: 10px;
    border: solid white;
    border-width: 0 2px 2px 0;
    transform: rotate(45deg);
  }

  /* Responsive */
  @media (max-width: 640px) {
    .roadmap-controls {
      top: 0.25rem;
      right: 0.25rem;
    }
    .mini-map {
      width: 100px;
      height: 120px;
    }
    .reset-btn span { display: none; }
    .reset-btn { padding: 0.5rem; }

    .prob-item {
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .prob-name {
      order: 1;
      width: 100%;
    }
    .diff {
      order: 2;
    }
  }
</style>
