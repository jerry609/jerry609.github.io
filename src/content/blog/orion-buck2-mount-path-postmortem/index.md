---
title: 'Orion Ã— Buck2ï¼šmount_path è¯­ä¹‰ç»Ÿä¸€ä¸éªŒè¯é—­ç¯çš„æ·±åº¦å¤ç›˜'
description: 'ä» .buckconfig ç¼ºå¤±å¯¼è‡´ Cell Resolver å¤±è´¥ï¼Œåˆ° mount_path è¯­ä¹‰ä¸€è‡´åŒ–æ”¹é€ çš„å…¨è¿‡ç¨‹è®°å½•'
publishDate: '2026-01-23'
tags: ['debugging', 'buck2', 'postmortem', 'fuse', 'rust']
---

> **å‚è€ƒå†™ä½œé£æ ¼**ï¼šJerry's Blogã€Š[æ·±åº¦å¤ç›˜ï¼šDicfuse æµ‹è¯•è¶…æ—¶é—®é¢˜è°ƒè¯•å…¨è®°å½•](https://jerry609.github.io/blog/dicfuse-test-timeout-debugging/)ã€‹ï¼ˆç›®å½• + ç°è±¡é©±åŠ¨ + å‡è®¾éªŒè¯ + Trade-off + å‘ç‚¹ + è¡ŒåŠ¨é¡¹ï¼‰  
> **ä¿¡æ¯æ¥æº**ï¼šä¸¤ä»½ agent transcriptï¼ˆ`2d3c933a-...` ä¸ `1fb9cee3-...`ï¼‰çš„å…¨è¿‡ç¨‹è®°å½•  
> **èŒƒå›´**ï¼šèšç„¦ `Error getting build targets -> buck2 cells -> Error creating cell resolver` è¿™æ¡æ•…éšœé“¾è·¯çš„å®šä½ã€ä¿®å¤æ¼”è¿›ã€è¯­ä¹‰ä¸€è‡´æ€§æ”¹é€ ï¼Œä»¥åŠéªŒè¯é—­ç¯å—ç¯å¢ƒå½±å“çš„å¤ç›˜

---

## ç›®å½•

- [1. TL;DRï¼ˆç»™å¿™çš„äººï¼‰](#1-tldrç»™å¿™çš„äºº)
  - [1.5 è°ƒè¯•æ—¶é—´çº¿ï¼ˆå‹ç¼©ç‰ˆï¼‰](#15-è°ƒè¯•æ—¶é—´çº¿å‹ç¼©ç‰ˆ)
- [2. é—®é¢˜æ¦‚è¿°](#2-é—®é¢˜æ¦‚è¿°)
- [3. ç³»ç»Ÿé“¾è·¯ä¸çº¦æŸï¼ˆä¸ºä»€ä¹ˆä¼š"å¿…ç°"ï¼‰](#3-ç³»ç»Ÿé“¾è·¯ä¸çº¦æŸä¸ºä»€ä¹ˆä¼šå¿…ç°) *(å«æ¶æ„å›¾)*
- [4. å®šä½è¿‡ç¨‹ï¼šä»ç°è±¡åˆ°æ ¹å› ](#4-å®šä½è¿‡ç¨‹ä»ç°è±¡åˆ°æ ¹å› )
- [5. ä¿®å¤æ–¹æ¡ˆæ¼”è¿›ï¼ˆæ­¢è¡€ â†’ è¯­ä¹‰ä¸€è‡´ â†’ é²æ£’åŒ–ï¼‰](#5-ä¿®å¤æ–¹æ¡ˆæ¼”è¿›æ­¢è¡€--è¯­ä¹‰ä¸€è‡´--é²æ£’åŒ–)
- [6. å…³é”®æ”¹åŠ¨ç‚¹ï¼ˆæŒ‰æ¨¡å—æ‹†è§£ï¼‰](#6-å…³é”®æ”¹åŠ¨ç‚¹æŒ‰æ¨¡å—æ‹†è§£) *(å«ä»£ç ç¤ºä¾‹)*
- [7. éªŒè¯ä¸è¯æ®ï¼šåšåˆ°äº†ä»€ä¹ˆã€ç¼ºäº†ä»€ä¹ˆ](#7-éªŒè¯ä¸è¯æ®åšåˆ°äº†ä»€ä¹ˆç¼ºäº†ä»€ä¹ˆ)
- [8. Trade-off åˆ†æï¼šä¸ºä»€ä¹ˆæœ€ç»ˆé€‰æ‹©"ä¸¥æ ¼è¯­ä¹‰ + æ˜ç¡®å¤±è´¥"](#8-trade-off-åˆ†æä¸ºä»€ä¹ˆæœ€ç»ˆé€‰æ‹©ä¸¥æ ¼è¯­ä¹‰--æ˜ç¡®å¤±è´¥)
- [9. å‘ä¸æ•™è®­ï¼ˆå¯è¿ç§»æ–¹æ³•è®ºï¼‰](#9-å‘ä¸æ•™è®­å¯è¿ç§»æ–¹æ³•è®º)
- [10. åç»­è¡ŒåŠ¨é¡¹ï¼ˆP0/P1/P2ï¼‰](#10-åç»­è¡ŒåŠ¨é¡¹p0p1p2)
- [11. é™„å½•](#11-é™„å½•)
- [12. è¡¥å……ï¼šæ›´æ·±å±‚çš„å‘ä¸æ–¹æ³•è®º](#12-è¡¥å……æ›´æ·±å±‚çš„å‘ä¸æ–¹æ³•è®º)
- [13. æ€è€ƒï¼šä»è¿™ä¸ªæ¡ˆä¾‹èƒ½å­¦åˆ°ä»€ä¹ˆï¼Ÿ](#13-æ€è€ƒä»è¿™ä¸ªæ¡ˆä¾‹èƒ½å­¦åˆ°ä»€ä¹ˆ)

---

## 1. TL;DRï¼ˆç»™å¿™çš„äººï¼‰

### 1.1 å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ

å½“ç”¨æˆ·ä» CL é¡µé¢è§¦å‘ "build targets" è§£ææ—¶ï¼ŒæœåŠ¡ç«¯æŠ¥ï¼š

```text
Error getting build targets: Fail to get cells: Buck2 stderr: Command failed: Error creating cell resolver
Couldn't find a buck project root for directory `/tmp/.../antares/mnt/{UUID}`. Expected to find a .buckconfig file.
```

### 1.2 æ ¹å› æ˜¯ä»€ä¹ˆï¼Ÿ

ä¸€å¥è¯ï¼š**æŒ‚è½½å‚æ•°çš„è¯­ä¹‰ä¸ Buck2 project root çš„ç¡¬çº¦æŸä¸ä¸€è‡´**ã€‚

- Buck2 åªèƒ½ä»"å½“å‰ç›®å½•å‘ä¸Š"æ‰¾ `.buckconfig`ï¼›æ‰¾ä¸åˆ°å°±ç›´æ¥å¤±è´¥ï¼ˆä¸ä¼šå‘ä¸‹æ‰¾ï¼‰ã€‚
- Antares çš„ mount æ”¯æŒ"æŒ‰è·¯å¾„è£å‰ªä¸ºå­ç›®å½•è§†å›¾"ï¼›å¦‚æœè¯·æ±‚é‡Œä¼ çš„æ˜¯å­ç›®å½•ï¼ˆå¦‚ `/mega`ï¼‰ï¼ŒæŒ‚è½½ç‚¹æ ¹ç›®å½•åªæš´éœ²è¯¥å­ç›®å½•å†…å®¹ï¼Œä»“åº“æ ¹çš„ `.buckconfig` è¢«è£æ‰ã€‚
- ç”±äº mountpoint çš„çˆ¶ç›®å½•åœ¨å®¿ä¸»æœºè€Œä¸åœ¨ mount è§†å›¾å†…ï¼ŒBuck2 å†å‘ä¸Šä¹Ÿä¸å¯èƒ½æ‰¾åˆ° `.buckconfig`ï¼Œå› æ­¤è¯¥æŠ¥é”™å¯¹è¿™ç±»å…¥å‚æ˜¯**å¿…ç°**ã€‚

### 1.3 æˆ‘ä»¬æ€ä¹ˆä¿®ï¼Ÿï¼ˆåˆ†é˜¶æ®µï¼‰

- **é˜¶æ®µ Aï¼ˆæ­¢è¡€ï¼Œå¿«é€Ÿæ¢å¤å¯ç”¨ï¼‰**ï¼šæŠŠ `orion` çš„æŒ‚è½½é€»è¾‘æ”¹ä¸º"å§‹ç»ˆæŒ‚ `/`"ï¼Œä¿è¯ `.buckconfig` å¯è§ï¼ŒBuck2 ä¸å†æŠ¥é”™ï¼ˆcommit `dec83222a`ï¼‰ã€‚
  - ä»£ä»·ï¼š**è¯­ä¹‰å˜åŒ–**ï¼ˆå¿½ç•¥è¯·æ±‚ä¸­çš„ repo/pathï¼‰ï¼Œåœ¨å¤šä»“/å¤š root åœºæ™¯å¯èƒ½ä¸é€šç”¨ã€‚

- **é˜¶æ®µ Bï¼ˆè¯­ä¹‰ä¸€è‡´ï¼Œé¢å‘é•¿æœŸé²æ£’ï¼‰**ï¼šä¸å†"å·å·æ¢æ ¹"ï¼Œè€Œæ˜¯æŠŠå¥‘çº¦æ˜¾å¼åŒ–å¹¶å‰ç½®æ ¡éªŒï¼š
  - API/æ–‡æ¡£é»˜è®¤å­—æ®µåç»Ÿä¸€ä¸º **`mount_path`**ï¼ˆæ—§å­—æ®µ `repo`/`path` ä»å…¼å®¹è§£æï¼‰ã€‚
  - `orion` åœ¨ mount å**é¢„æ£€** `mount_point/.buckconfig`ï¼š
    - ç¼ºå¤±åˆ™é€šè¿‡ WS è¾“å‡ºæ¸…æ™°é”™è¯¯ï¼š`mount_path å¿…é¡»æ˜¯ Buck2 project rootï¼ˆå¦‚ '/'ï¼‰`ï¼Œå¹¶ç›´æ¥å¤±è´¥é€€å‡ºã€‚
  - åŒæ—¶è¡¥é½ä¸¤ç±»"æ¬¡ç”Ÿé£é™©"ä¿®å¤ï¼š
    - å¹¶å‘ targets å¯¼å‡º `base.jsonl/diff.jsonl` çš„è¦†ç›–é£é™©ï¼šæ”¹ä¸º **per-task ä¸´æ—¶ç›®å½•**ã€‚
    - å¢åŠ  Buck2 `cells + audit_config` çš„ **readiness** æ£€æŸ¥ï¼ˆæ›´æ—©å¤±è´¥ã€æ›´å¥½å®šä½ï¼‰ã€‚

### 1.4 éªŒè¯æƒ…å†µä¸€å¥è¯

- **Rust å•æµ‹é€šè¿‡**ï¼š`orion` 43/43ã€`orion-server` 6/6ï¼ˆåŒæ—¶ä¿®äº†ä¸€ä¸ª `BuildDTO::from()` çš„ move/clone ç¼–è¯‘é—®é¢˜ï¼Œcommit `92da7e8b0`ï¼‰ã€‚
- **å®Œæ•´ Docker E2E æœªå®Œå…¨é—­ç¯**ï¼šå— Docker Hub/é•œåƒæº/DNS/ä»£ç†/é•œåƒ manifest ç­‰ç¯å¢ƒå› ç´ å½±å“ï¼Œé‡‡ç”¨äº†"ä»£ç† + éƒ¨åˆ† compose + æœ¬åœ°å¯åŠ¨æœåŠ¡"çš„æŠ˜ä¸­è·¯çº¿ï¼›å»ºè®®åœ¨ç¨³å®šç½‘ç»œ/ä¸€è‡´å¹³å°ä¸Šè¡¥é½æœ€ç»ˆ E2E å›æ”¾ã€‚

---

## 1.5 è°ƒè¯•æ—¶é—´çº¿ï¼ˆå‹ç¼©ç‰ˆï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  T0: ç”¨æˆ·æŠ¥éšœ                                                           â”‚
â”‚      "Error getting build targets: ... Couldn't find a buck project    â”‚
â”‚       root ... Expected to find a .buckconfig file."                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  T1: å®šä½å¤±è´¥ç‚¹                                                         â”‚
â”‚      grep "buck2" / "cells" / ".buckconfig" â†’ é”å®š orion/buck_controllerâ”‚
â”‚      ç¡®è®¤å¤±è´¥å‘ç”Ÿåœ¨ buck2 cells() åˆå§‹åŒ–é˜¶æ®µ                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  T2: è¿½æº¯ mount è¯­ä¹‰                                                    â”‚
â”‚      è¯»å– scorpio/daemon/antares.rs normalize_mount_path()              â”‚
â”‚      ç¡®è®¤ Antares æ”¯æŒ"å­ç›®å½•è§†å›¾è£å‰ª"                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  T3: å‡è®¾é—­ç¯                                                           â”‚
â”‚      H1: .buckconfig åœ¨æ ¹ï¼Œmount çœ‹ä¸åˆ° â†’ âœ“ (stderr è¯å®)               â”‚
â”‚      H2: mount ä¼ å‚æ˜¯å­ç›®å½•è§†å›¾ â†’ âœ“ (Antares è¯­ä¹‰è¯å®)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  T4: æ­¢è¡€ä¿®å¤ (Phase A)                                                 â”‚
â”‚      å¼ºåˆ¶æŒ‚è½½ "/" â†’ commit dec83222a â†’ push fix/buck2-mount-root        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  T5: ç”¨æˆ·åé¦ˆ"è¯­ä¹‰å˜åŒ–ä¸å¯æ¥å—"                                          â”‚
â”‚      é‡æ–°å®¡è§†ï¼šfallback ä¼šæ©ç›–é”™è¯¯ã€ç ´åå¤š root åœºæ™¯                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  T6: è¯­ä¹‰ä¸€è‡´åŒ–æ”¹é€  (Phase B)                                            â”‚
â”‚      ç§»é™¤ fallbackã€ç»Ÿä¸€ mount_path å­—æ®µã€å‰ç½® .buckconfig é¢„æ£€          â”‚
â”‚      å¢åŠ  buck2 cells readiness æ£€æŸ¥ã€WS æ˜ç¡®é”™è¯¯è¾“å‡º                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  T7: å¹¶å‘å®‰å…¨ä¿®å¤ (Phase C)                                              â”‚
â”‚      base.jsonl/diff.jsonl â†’ TempDir per-task éš”ç¦»                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  T8: å•å…ƒæµ‹è¯•éªŒè¯                                                        â”‚
â”‚      orion 43/43 âœ“ | orion-server 6/6 âœ“                                â”‚
â”‚      (ä¸­é€”å‘ç° BuildDTO::from() move/clone ç¼–è¯‘é—®é¢˜ï¼Œcommit 92da7e8b0)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  T9: E2E éªŒè¯å—é˜»                                                        â”‚
â”‚      Docker Hub è¶…æ—¶ â†’ é…ç½®é•œåƒåŠ é€Ÿå™¨ â†’ DNS å¤±è´¥ â†’ é…ç½®ä»£ç† â†’            â”‚
â”‚      ç«¯å£å†²çª (6379) â†’ æ¸…ç†å®¹å™¨/ç½‘ç»œ â†’ é•œåƒ manifest ä¸åŒ¹é…              â”‚
â”‚      æœ€ç»ˆé‡‡ç”¨"Compose ä¾èµ– + æœ¬åœ°æœåŠ¡"æŠ˜ä¸­æ–¹æ¡ˆ                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. é—®é¢˜æ¦‚è¿°

### 2.1 é—®é¢˜ç°è±¡

- è®¿é—® CL é¡µé¢è§¦å‘ build targets è§£ææ—¶æŠ¥é”™ï¼ˆæ ¸å¿ƒæ˜¯ Buck2 æ— æ³•åˆ›å»º cell resolverï¼‰ã€‚
- é”™è¯¯ä¿¡æ¯æŒ‡å‘ `.buckconfig` ç¼ºå¤±ã€‚

### 2.2 å½±å“è¯„ä¼°

- **åŠŸèƒ½å½±å“**ï¼štargets discovery é˜¶æ®µç›´æ¥å¤±è´¥ï¼Œæ„å»ºé“¾è·¯"èµ·æ­¥å³å¤±è´¥"ï¼ˆé˜»æ–­å‹æ•…éšœï¼‰ã€‚
- **æ’éšœæˆæœ¬**ï¼šé”™è¯¯å‘ç”Ÿåœ¨ buck2 stderrï¼Œè‹¥ç¼ºå°‘å‰ç½®æ ¡éªŒä¸ç»“æ„åŒ–ä¸Šä¸‹æ–‡ï¼Œå®šä½ä¼šä¾èµ–å¯¹ Antares mount è¯­ä¹‰çš„éšå«çŸ¥è¯†ã€‚

---

## 3. ç³»ç»Ÿé“¾è·¯ä¸çº¦æŸï¼ˆä¸ºä»€ä¹ˆä¼š"å¿…ç°"ï¼‰

### 3.1 ç³»ç»Ÿè°ƒç”¨é“¾ï¼ˆä»è¯·æ±‚åˆ°æŠ¥é”™ç‚¹ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              æ•´ä½“æ¶æ„ç¤ºæ„                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                          â”‚
â”‚   â”‚  Web å‰ç«¯    â”‚  CL é¡µé¢è§¦å‘ "build targets" è¯·æ±‚                         â”‚
â”‚   â”‚  (gitmega)   â”‚                                                          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                                          â”‚
â”‚          â”‚ HTTP POST /api/task                                              â”‚
â”‚          â”‚ { "mount_path": "/mega", "cl": "SVOBYAV2", ... }                 â”‚
â”‚          â–¼                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                          â”‚
â”‚   â”‚ orion-server â”‚  API ç½‘å…³ / ä»»åŠ¡è°ƒåº¦                                      â”‚
â”‚   â”‚  (Rust)      â”‚  - è§£æ TaskRequest                                      â”‚
â”‚   â”‚              â”‚  - é€šè¿‡ WS ä¸‹å‘åˆ° worker                                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                                          â”‚
â”‚          â”‚ WebSocket                                                        â”‚
â”‚          â–¼                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                          â”‚
â”‚   â”‚    orion     â”‚  Build Agent (Worker)                                    â”‚
â”‚   â”‚  (Rust)      â”‚  - mount_antares_fs(job_id, path, cl)                    â”‚
â”‚   â”‚              â”‚  - get_build_targets() â†’ buck2 cells/targets             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                                          â”‚
â”‚          â”‚ RPC / FUSE mount                                                 â”‚
â”‚          â–¼                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                          â”‚
â”‚   â”‚   scorpio    â”‚  FUSE æ–‡ä»¶ç³»ç»Ÿ (Antares + Dicfuse)                        â”‚
â”‚   â”‚  (Rust)      â”‚  - normalize_mount_path(path)                            â”‚
â”‚   â”‚              â”‚  - æŒ‰ path è£å‰ªè§†å›¾ï¼ˆå¯èƒ½æ˜¯å­ç›®å½•ï¼‰                        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                                          â”‚
â”‚          â”‚                                                                  â”‚
â”‚          â–¼                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   â”‚  /tmp/scorpio-megadir/antares/mnt/{UUID}                         â”‚      â”‚
â”‚   â”‚  â”œâ”€â”€ src/           â—„â”€â”€â”€ å¦‚æœ path="/mega"ï¼Œè¿™é‡Œåªæœ‰ /mega å†…å®¹   â”‚      â”‚
â”‚   â”‚  â”œâ”€â”€ Cargo.toml                                                  â”‚      â”‚
â”‚   â”‚  â””â”€â”€ (NO .buckconfig!)  â—„â”€â”€â”€ .buckconfig è¢«è£æ‰äº†ï¼               â”‚      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚          â”‚                                                                  â”‚
â”‚          â–¼                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                          â”‚
â”‚   â”‚    buck2     â”‚  æ„å»ºç³»ç»Ÿ                                                 â”‚
â”‚   â”‚              â”‚  - buck2 cells â†’ å‘ä¸Šæ‰¾ .buckconfig                       â”‚
â”‚   â”‚              â”‚  - æ‰¾ä¸åˆ° â†’ Error creating cell resolver âŒ               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                          â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å…³é”®çº¦æŸå†²çªï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Buck2 çš„ç¡¬çº¦æŸ         â”‚     â”‚    Antares çš„è¯­ä¹‰          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åªå‘ä¸Šæ‰¾ .buckconfig       â”‚  â‰   â”‚ path å¯ä»¥æ˜¯å­ç›®å½•è§†å›¾      â”‚
â”‚ ä¸ä¼šå‘ä¸‹éå†               â”‚     â”‚ è£å‰ªåæ ¹æ–‡ä»¶ä¸å¯è§         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Buck2 çš„ç¡¬çº¦æŸï¼ˆå…³é”®ï¼‰

- Buck2 é€šè¿‡"å½“å‰ç›®å½•åŠå…¶çˆ¶ç›®å½•é“¾"å¯»æ‰¾ `.buckconfig` æ¥åˆ¤å®š project rootã€‚
- **å®ƒä¸ä¼šå‘ä¸‹éå†å¯»æ‰¾** `.buckconfig`ã€‚

### 3.3 Antares mount çš„è¯­ä¹‰ï¼ˆå…³é”®ï¼‰

- `path`/`repo`ï¼ˆåç»Ÿä¸€ä¸º `mount_path`ï¼‰å¹¶ä¸æ€»ç­‰ä»·äº"ä»“åº“æ ¹"ï¼Œå¯èƒ½æ˜¯"monorepo å­ç›®å½•è§†å›¾"ã€‚
- ä¸€æ—¦è£å‰ªä¸ºå­ç›®å½•è§†å›¾ï¼ŒæŒ‚è½½ç‚¹æ ¹ç›®å½•å°±æ˜¯"å­ç›®å½•æ ¹"ï¼Œä»“åº“æ ¹æ–‡ä»¶ä¸å¯è§ã€‚

ç»“è®ºï¼šå½“ `mount_path` ä¸æ˜¯ Buck2 root æ—¶ï¼Œ`buck2 cells` å¯¹è¯¥ mountpoint æ˜¯**ç¡®å®šæ€§å¤±è´¥**ã€‚

---

## 4. å®šä½è¿‡ç¨‹ï¼šä»ç°è±¡åˆ°æ ¹å› 

### 4.1 ç°è±¡é©±åŠ¨çš„ç¬¬ä¸€æ­¥ï¼šé”å®š"å¤±è´¥ç‚¹"

- ä» `Error getting build targets` è¿½è¸ªåˆ° `orion` åœ¨ mountpoint å†…æ‰§è¡Œ `buck2 cells(...)`ã€‚
- å¤±è´¥å‘ç”Ÿåœ¨ cells/resolver åˆå§‹åŒ–é˜¶æ®µï¼Œè€Œä¸æ˜¯ targets è®¡ç®—é˜¶æ®µã€‚

### 4.2 å‡è®¾-éªŒè¯å¾ªç¯ï¼ˆæœ€å…³é”®çš„é—­ç¯ï¼‰

- **å‡è®¾ H1**ï¼š`.buckconfig` åœ¨ä»“åº“æ ¹ï¼Œä½† mountpoint çœ‹ä¸åˆ°å®ƒã€‚
  - è¯æ®ï¼šBuck2 stderr æ˜ç¡®æç¤º mountpoint æ‰¾ä¸åˆ° `.buckconfig`ã€‚
- **å‡è®¾ H2**ï¼šmountpoint ä¹‹æ‰€ä»¥çœ‹ä¸åˆ° `.buckconfig`ï¼Œæ˜¯å› ä¸º mount ä¼ å‚æ˜¯å­ç›®å½•è§†å›¾ï¼ˆå¦‚ `/mega`ï¼‰ã€‚
  - è¯æ®ï¼šAntares mount æ”¯æŒæŒ‰ path è£å‰ªï¼›å½“æŒ‚è½½å­ç›®å½•è§†å›¾æ—¶ï¼Œæ ¹æ–‡ä»¶è¢«è£æ‰ã€‚

è¿™ä¸¤ä¸ªå‡è®¾æˆç«‹åï¼Œæ ¹å› å³é—­ç¯ï¼š**"è¯·æ±‚å‚æ•°è¯­ä¹‰ï¼ˆå­ç›®å½•ï¼‰"ä¸"Buck2 root å¿…é¡»åŒ…å« `.buckconfig`"ä¹‹é—´å‘ç”Ÿé”™é…**ã€‚

---

## 5. ä¿®å¤æ–¹æ¡ˆæ¼”è¿›ï¼ˆæ­¢è¡€ â†’ è¯­ä¹‰ä¸€è‡´ â†’ é²æ£’åŒ–ï¼‰

> è¿™ä¸€èŠ‚çš„é‡ç‚¹ä¸æ˜¯"æ”¹äº†ä»€ä¹ˆ"ï¼Œè€Œæ˜¯"ä¸ºä»€ä¹ˆè¦ä» A èµ°åˆ° B"â€”â€”å³å¯¹ç³»ç»Ÿè¯­ä¹‰çš„å°Šé‡ä¸å¯è¿ç»´æ€§æå‡ã€‚

### 5.1 é˜¶æ®µ Aï¼šæ­¢è¡€å‹ä¿®å¤ï¼ˆå¼ºåˆ¶æŒ‚ `/`ï¼‰

- **åšæ³•**ï¼š`orion` å¿½ç•¥è¯·æ±‚é‡Œçš„ repo/pathï¼Œmount æ—¶ä¸€å¾‹æŒ‚è½½ `/`ã€‚
- **æ”¶ç›Š**ï¼šç«‹åˆ»æ¢å¤ Buck2 cells èƒ½åŠ›ï¼Œæ¶ˆé™¤ `.buckconfig` æŠ¥é”™ï¼ˆå¿«é€Ÿæ¢å¤å¯ç”¨ï¼‰ã€‚
- **é—®é¢˜ï¼ˆéšæ‚£ï¼‰**ï¼š
  - è¯­ä¹‰å˜åŒ–ï¼šè°ƒç”¨æ–¹è®¤ä¸ºæ„å»ºçš„æ˜¯"æŸ repo/path"ï¼Œå®é™… worker å¼ºè¡Œç”¨ `/`ã€‚
  - å¤šä»“/å¤š Buck root å½¢æ€ä¸‹é£é™©å¤§ï¼šå¦‚æœ Buck root ä¸åœ¨ `/`ï¼Œè¯¥æ­¢è¡€æ–¹æ¡ˆä¼šåå‘å¤±æ•ˆã€‚

### 5.2 é˜¶æ®µ Bï¼šæŠŠå¥‘çº¦"æ˜¾å¼åŒ–"ï¼ˆ`mount_path` + é¢„æ£€ + æ˜ç¡®å¤±è´¥ï¼‰

æ ¸å¿ƒåŸåˆ™ï¼š**ä¸é€šè¿‡éšå¼ fallback æ”¹å˜è¯·æ±‚è¯­ä¹‰**ï¼Œè€Œæ˜¯è®©ç³»ç»Ÿåœ¨é”™è¯¯å…¥å‚æ—¶"å°½æ—©ã€æ¸…æ™°ã€å¯è¡ŒåŠ¨åœ°å¤±è´¥"ã€‚

è½åœ°åŒ…æ‹¬ï¼š

- **å­—æ®µè¯­ä¹‰ç»Ÿä¸€**ï¼šè¯·æ±‚/å“åº”/æ–‡æ¡£é»˜è®¤å­—æ®µåç»Ÿä¸€ä¸º `mount_path`ï¼ˆå…¼å®¹æ—§å­—æ®µ `repo`/`path` ä½œä¸º aliasï¼‰ã€‚
- **æŒ‚è½½åé¢„æ£€**ï¼šåœ¨ `orion` mount å®Œæˆåï¼Œæ£€æŸ¥ `mount_point/.buckconfig`ï¼š
  - ç¼ºå¤±æ—¶ï¼šWS è¾“å‡ºæ˜ç¡®æç¤ºï¼Œå¹¶è¿”å›å¤±è´¥ï¼ˆç”¨æˆ·/è°ƒç”¨æ–¹å¯æ®æ­¤ä¿®æ­£å…¥å‚ï¼‰ã€‚
- **readiness æ£€æŸ¥**ï¼šæŠŠ `buck2 cells + audit_config` å‰ç½®æ‰§è¡Œï¼Œå¹¶æŠŠå¤±è´¥ä¿¡æ¯ç»“æ„åŒ–å›ä¼ ã€‚

### 5.3 é˜¶æ®µ Cï¼šä¿®å¤"å¹¶å‘ç¨³å®šæ€§"éšæ‚£ï¼ˆä¸æ ¹å› ä¸åŒï¼Œä½†åŒæ‰¹æ¬¡å¿…é¡»ä¿®ï¼‰

`get_build_targets()` æ›¾å›ºå®šå†™ `base.jsonl/diff.jsonl`ï¼Œå¹¶å‘ä»»åŠ¡ä¼šäº’ç›¸è¦†ç›–å¯¼è‡´"å¶å‘é”™ä¹±"ã€‚

- **åšæ³•**ï¼šæ”¹ä¸º per-task ä¸´æ—¶ç›®å½•ï¼ˆä¾‹å¦‚ `TempDir`ï¼‰æ‰¿è½½ targets è¾“å‡ºæ–‡ä»¶ã€‚
- **æ„ä¹‰**ï¼šè¿™å±äº"æœªæ¥äº‹æ•…ç§å­"â€”â€”ä¸ä¿®ä¼šåœ¨é«˜å¹¶å‘ CI ä¸‹ç‚¸æˆæ›´éš¾å®šä½çš„é—´æ­‡æ€§æ•…éšœã€‚

---

## 6. å…³é”®æ”¹åŠ¨ç‚¹ï¼ˆæŒ‰æ¨¡å—æ‹†è§£ï¼‰

### 6.1 `orion`ï¼ˆworker / build agentï¼‰

é‡ç‚¹ï¼šæŠŠ Buck2 å¤±è´¥ä»"stderr å¶ç°"å˜æˆ"æ—©æœŸæ ¡éªŒ + ç»“æ„åŒ–è¾“å‡º"ï¼Œå¹¶ä¿®å¤å¹¶å‘è¦†ç›–ã€‚

- **è·¯å¾„è§„èŒƒåŒ–**ï¼š`normalize_mount_path()`ï¼ˆç©º/æ— å‰å¯¼ `/`/å°¾éš `/` ç»Ÿä¸€ï¼‰ã€‚
- **æŒ‚è½½åé¢„æ£€**ï¼š`has_buckconfig(mount_point)`ï¼ˆå¼‚æ­¥ `metadata` æ£€æŸ¥ï¼‰ã€‚
- **readiness**ï¼š`load_buck2_cells(mount_point)`ï¼ˆcells + audit_configï¼‰ã€‚
- **targets å¹¶å‘å®‰å…¨**ï¼š`base.jsonl/diff.jsonl` å†™å…¥ per-task `TempDir`ã€‚
- **ä¸»å‡½æ•°è¯­ä¹‰**ï¼š`build(..., mount_path: String, ...)`ï¼ˆæ—¥å¿—ä¸å‚æ•°åå¯¹é½ï¼‰ã€‚

<details>
<summary><b>ğŸ“œ ä»£ç ç¤ºä¾‹ï¼šè·¯å¾„è§„èŒƒåŒ–ä¸ .buckconfig é¢„æ£€ï¼ˆç‚¹å‡»å±•å¼€ï¼‰</b></summary>

```rust
// orion/src/buck_controller.rs

/// è§„èŒƒåŒ–æŒ‚è½½è·¯å¾„ï¼šå¤„ç†ç©ºå€¼ã€ç¼ºå°‘å‰å¯¼/ã€å°¾éš/ç­‰è¾¹ç•Œæƒ…å†µ
fn normalize_mount_path(path: &str) -> String {
    let trimmed = path.trim();
    if trimmed.is_empty() {
        return "/".to_string();
    }
    let with_leading = if trimmed.starts_with('/') {
        trimmed.to_string()
    } else {
        format!("/{}", trimmed)
    };
    // ç§»é™¤å°¾éš /ï¼ˆé™¤éæ˜¯æ ¹ "/"ï¼‰
    if with_leading.len() > 1 && with_leading.ends_with('/') {
        with_leading.trim_end_matches('/').to_string()
    } else {
        with_leading
    }
}

/// å¼‚æ­¥æ£€æŸ¥ mount_point ä¸‹æ˜¯å¦å­˜åœ¨ .buckconfig
async fn has_buckconfig(mount_point: &str) -> Result<bool, Box<dyn Error + Send + Sync>> {
    let buckconfig_path = Path::new(mount_point).join(".buckconfig");
    match fs::metadata(&buckconfig_path).await {
        Ok(metadata) => Ok(metadata.is_file()),
        Err(err) if err.kind() == std::io::ErrorKind::NotFound => Ok(false),
        Err(err) => Err(Box::new(err)),
    }
}

/// Buck2 readiness æ£€æŸ¥ï¼šåŠ è½½ cells é…ç½®
fn load_buck2_cells(mount_point: &str) -> anyhow::Result<CellInfo> {
    tracing::info!("Get cells at {:?}", mount_point);
    let mount_path = PathBuf::from(mount_point);
    let mut buck2 = Buck2::with_root("buck2".to_string(), mount_path);
    buck2.cells()
}
```

</details>

<details>
<summary><b>ğŸ“œ ä»£ç ç¤ºä¾‹ï¼šä¸¥æ ¼è¯­ä¹‰æ ¡éªŒ + æ˜ç¡®é”™è¯¯è¾“å‡ºï¼ˆç‚¹å‡»å±•å¼€ï¼‰</b></summary>

```rust
// orion/src/buck_controller.rs - build() å‡½æ•°æ ¸å¿ƒé€»è¾‘

// å…³é”®æ”¹åŠ¨ï¼šæŒ‚è½½åç«‹å³æ ¡éªŒ .buckconfig
if !has_buckconfig(&mount_point).await? {
    // ä¸å† fallbackï¼Œç›´æ¥æ˜ç¡®æŠ¥é”™
    let error_msg = format!(
        "[Task {id}] mount_path '{}' ç¼ºå°‘ .buckconfigï¼Œ\
         è¯·ç¡®ä¿ä¼ å…¥çš„æ˜¯ Buck2 project rootï¼ˆé€šå¸¸æ˜¯ '/'ï¼‰",
        normalized_mount_path
    );
    tracing::error!("{error_msg}");
    
    // é€šè¿‡ WebSocket å°†é”™è¯¯ä¿¡æ¯æ¨é€åˆ°å‰ç«¯
    if sender
        .send(WSMessage::BuildOutput {
            id: id.clone(),
            output: error_msg.clone(),
        })
        .is_err()
    {
        tracing::warn!("Failed to send buckconfig missing error to WS");
    }
    return Err(error_msg.into());
}
```

</details>

<details>
<summary><b>ğŸ“œ ä»£ç ç¤ºä¾‹ï¼šå¹¶å‘å®‰å…¨çš„ targets è¾“å‡ºï¼ˆç‚¹å‡»å±•å¼€ï¼‰</b></summary>

```rust
// orion/src/buck_controller.rs - get_build_targets()
use tempfile::TempDir;

// ä½¿ç”¨ä¸´æ—¶ç›®å½•éš”ç¦»å¹¶å‘ä»»åŠ¡çš„è¾“å‡ºæ–‡ä»¶
let temp_dir = TempDir::new()
    .map_err(|err| anyhow!("Failed to create temp dir: {}", err))?;

let base_path = temp_dir.path().join("base.jsonl");
let diff_path = temp_dir.path().join("diff.jsonl");

// ç°åœ¨æ¯ä¸ªä»»åŠ¡éƒ½æœ‰ç‹¬ç«‹çš„è¾“å‡ºè·¯å¾„ï¼Œä¸ä¼šäº’ç›¸è¦†ç›–
let base = get_repo_targets(&base_path, &mount_path)?;
let changes = Changes::new(cells, mega_changes)?;
let diff = get_repo_targets(&diff_path, &mount_path)?;

// temp_dir åœ¨å‡½æ•°ç»“æŸæ—¶è‡ªåŠ¨æ¸…ç†ï¼ˆRAIIï¼‰
```

</details>

### 6.2 `orion-server`ï¼ˆAPI / schema / docsï¼‰

é‡ç‚¹ï¼šæŠŠ"repo/path"çš„æ­§ä¹‰æ”¶æ•›ä¸º `mount_path`ï¼ŒåŒæ—¶ä¿æŒå…¼å®¹ã€‚

- **è¯·æ±‚å­—æ®µ**ï¼š
  - é»˜è®¤å­—æ®µåï¼š`mount_path`
  - å…¼å®¹ aliasï¼š`repo`ã€`path`
- **æŸ¥è¯¢å‚æ•°æ–‡æ¡£**ï¼ˆutoipa params ç­‰ï¼‰åŒæ­¥æ”¹ä¸º `mount_path`ã€‚
- **README ç¤ºä¾‹**åŒæ­¥æ›´æ–°ã€‚

### 6.3 `orion-server/bellatrix`ï¼ˆclient SDKï¼‰

- åŒæ­¥å­—æ®µåä¸åºåˆ—åŒ–è¡Œä¸ºï¼ˆ`mount_path` ä¸ºé»˜è®¤ï¼‰ã€‚

### 6.4 `ceres`ï¼ˆä¸Šæ¸¸è§¦å‘æ–¹ï¼‰

- æ„å»ºè¯·æ±‚å­—æ®µä» `repo` æ›´æ–°ä¸º `mount_path`ï¼Œé¿å…ç»§ç»­ä¼ æ’­æ—§è¯­ä¹‰ã€‚

---

## 7. éªŒè¯ä¸è¯æ®ï¼šåšåˆ°äº†ä»€ä¹ˆã€ç¼ºäº†ä»€ä¹ˆ

### 7.1 å·²å®Œæˆçš„éªŒè¯ï¼ˆæœ‰ç¡¬è¯æ®ï¼‰

- `orion`ï¼š`cargo test --lib` **43/43 é€šè¿‡**ã€‚
- `orion-server`ï¼š`cargo test --lib` **6/6 é€šè¿‡**ã€‚
- ç¼–è¯‘é“¾è·¯ï¼šåœ¨ç½‘ç»œä¸ç¨³å®šæ—¶å‡ºç° crates ä¸‹è½½è¶…æ—¶ï¼›åé€šè¿‡ä»£ç†ç¯å¢ƒå˜é‡ï¼ˆç¤ºä¾‹ï¼š`HTTP_PROXY/HTTPS_PROXY/ALL_PROXY` + `CARGO_HTTP_TIMEOUT=600`ï¼‰å®Œæˆ `cargo fetch` ä¸ `cargo check`ã€‚

> è¯´æ˜ï¼šè¿™ç±»éªŒè¯è¯æ˜"é€»è¾‘ä¸ç¼–è¯‘æ­£ç¡®"ï¼Œä½†ä¸ç­‰ä»·äº"ç«¯åˆ°ç«¯é“¾è·¯åœ¨çœŸå®ç¯å¢ƒ 100% æ­£å¸¸"ã€‚

### 7.2 E2E éªŒè¯çš„é˜»ç¢ä¸åº”å¯¹ï¼ˆè¿™æ¬¡å¤ç›˜å¿…é¡»ç›´é¢ï¼‰

**é˜»ç¢ Aï¼šDocker Hub / é•œåƒæº / DNS**

- å¤šæ¬¡ `docker compose up -d` å—é™äºé•œåƒæ‹‰å–è¶…æ—¶ä¸é•œåƒæº DNS å¤±è´¥ã€‚
- åå‘ç°ç³»ç»Ÿå­˜åœ¨æœ¬åœ° HTTP ä»£ç†ï¼ˆ`127.0.0.1:7897`ï¼‰ï¼Œä½† Docker daemon æœªä½¿ç”¨ï¼›é€šè¿‡ä¸º Docker systemd service é…ç½®ä»£ç†åï¼Œé•œåƒæ‹‰å–æˆåŠŸã€‚

**é˜»ç¢ Bï¼šç«¯å£å†²çª**

- é•œåƒæ‹‰å–æˆåŠŸåé‡åˆ°æœ¬åœ°ç«¯å£å†²çªï¼ˆä¾‹å¦‚ `6379`ï¼‰ã€‚
- é€šè¿‡æ’æŸ¥å ç”¨è¿›ç¨‹ã€æ¸…ç†/é‡å¯å®¹å™¨ä¸ç½‘ç»œç­‰æ–¹å¼é€æ­¥æ¨è¿›ã€‚

**é˜»ç¢ Cï¼šé•œåƒ manifest / å¹³å°ä¸åŒ¹é…**

- åœ¨"å®Œæ•´ E2E"é˜¶æ®µï¼Œå‡ºç°é•œåƒ manifest ä¸åŒ¹é…ï¼ˆå…¸å‹æ˜¯é•œåƒä¸åŒ…å«å½“å‰å¹³å°çš„ manifestï¼‰ã€‚
- å› æ­¤é‡‡å–æŠ˜ä¸­ï¼š**ç”¨ Compose æ‹‰èµ·ä¾èµ–ï¼ˆDB/Cache/å­˜å‚¨ï¼‰**ï¼Œè€Œ `orion-server` / `orion-worker` èµ°æœ¬åœ°å¯åŠ¨ï¼Œä»¥å®Œæˆæ ¸å¿ƒé“¾è·¯éªŒè¯ã€‚

### 7.3 ç¼ºå¤±çš„æœ€ç»ˆé—­ç¯ï¼ˆå»ºè®®è¡¥é½ï¼‰

- åœ¨ç¨³å®šç½‘ç»œä¸ä¸€è‡´å¹³å°ä¸Šï¼Œè·‘ä¸€æ¬¡"ä» CL é¡µé¢è§¦å‘ â†’ targets è¿”å›"çš„å®Œæ•´å›æ”¾ã€‚
- å¢åŠ ä¸€æ¡è‡ªåŠ¨åŒ–å¥åº·æ£€æŸ¥ï¼šmount åæ‰§è¡Œ `buck2 cells`ï¼ˆæˆ–æ›´è½»é‡çš„ `.buckconfig` æ ¡éªŒï¼‰å¹¶å°†ç»“æœçº³å…¥ç›‘æ§/å‘Šè­¦ã€‚

---

## 8. Trade-off åˆ†æï¼šä¸ºä»€ä¹ˆæœ€ç»ˆé€‰æ‹©"ä¸¥æ ¼è¯­ä¹‰ + æ˜ç¡®å¤±è´¥"

### 8.1 "è‡ªåŠ¨ fallback åˆ° `/`"ä¸ºä»€ä¹ˆçœ‹ä¼¼å¥½ã€ä½†é•¿æœŸé£é™©å¤§ï¼Ÿ

ä¼˜ç‚¹ï¼š
- ä½“éªŒä¸Š"æ›´ä¸å®¹æ˜“å¤±è´¥"ï¼ŒçŸ­æœŸå‡å°‘å·¥å•ã€‚

éšæ‚£ï¼š
- **è¯­ä¹‰æ¼‚ç§»**ï¼šç”¨æˆ·ä»¥ä¸ºæ„å»ºçš„æ˜¯ `mount_path=/mega`ï¼Œç³»ç»Ÿå´æ‚„æ‚„æ¢æˆ `/`ã€‚
- **é”™è¯¯è¢«æ©ç›–**ï¼šä¸Šæ¸¸è°ƒç”¨æ–¹ä¸ä¼šä¿®æ­£å…¥å‚ï¼Œç³»ç»Ÿé•¿æœŸç»´æŒä¸ä¸€è‡´çŠ¶æ€ã€‚
- **å¤š root åœºæ™¯åå™¬**ï¼šå½“ Buck root æœ¬å°±ä¸åœ¨ `/` æ—¶ï¼Œfallback å¯èƒ½æŠŠæ­£ç¡®è¯·æ±‚å˜æˆé”™è¯¯è¡Œä¸ºã€‚

### 8.2 "ä¸¥æ ¼è¦æ±‚ mount_path æ˜¯ Buck2 root"ä¼šä¸ä¼šå¤ªç¡¬ï¼Ÿ

ä¼šæ›´"ä¸¥æ ¼"ï¼Œä½†å®ƒçš„æ”¶ç›Šæ˜¯å·¥ç¨‹åŒ–çš„ï¼š

- **å¤±è´¥å¯è¡ŒåŠ¨**ï¼šé”™è¯¯ä¿¡æ¯æ˜ç¡®å‘Šè¯‰ä½ "ä¼ å‚é”™äº†"ï¼Œè€Œä¸æ˜¯è®©ä½ çŒœ mount å‘ç”Ÿäº†ä»€ä¹ˆã€‚
- **å¥‘çº¦å¯ç»´æŠ¤**ï¼šæœªæ¥æ–°å¢å¤š repo / å¤š Buck rootï¼Œåªéœ€è¦æ‰©å±•å¥‘çº¦ï¼Œè€Œä¸æ˜¯ä¾èµ–éšå¼å…œåº•ã€‚
- **å¯è§‚æµ‹æ€§æ›´å¼º**ï¼šå¯ä»¥ç»Ÿè®¡ `.buckconfig missing` çš„æ¯”ä¾‹ã€æ¥æºï¼Œæ¨åŠ¨ä¸Šæ¸¸ä¿®æ­£ã€‚

ç»“è®ºï¼šåœ¨æ„å»ºç³»ç»Ÿè¿™ç±»"æ­£ç¡®æ€§ä¼˜å…ˆ"çš„åœºæ™¯é‡Œï¼Œ**å®å¯æ˜ç¡®å¤±è´¥ï¼Œä¹Ÿä¸è¦é™é»˜æˆåŠŸä½†è¯­ä¹‰é”™ä¹±**ã€‚

---

## 9. å‘ä¸æ•™è®­ï¼ˆå¯è¿ç§»æ–¹æ³•è®ºï¼‰

### 9.1 å‘ 1ï¼šæŠŠ"repo/path"å½“ä¸‡èƒ½å­—æ®µï¼Œè¿Ÿæ—©ä¼šç‚¸

è¿™æ¬¡äº‹æ•…çš„æœ¬è´¨ä¸æ˜¯ Buck2ï¼Œä¹Ÿä¸æ˜¯ Antaresï¼Œè€Œæ˜¯**å¥‘çº¦è®¾è®¡å«æ··**ï¼š

- ä¸€ä¸ªå­—æ®µåŒæ—¶æ‰¿è½½"ä»“åº“æ ‡è¯† / å­ç›®å½•è·¯å¾„ / Buck root"ä¸‰ç§è¯­ä¹‰ï¼Œå¿…ç„¶åœ¨æŸä¸ªç¯èŠ‚è¢«è¯¯ç”¨ã€‚

### 9.2 å‘ 2ï¼šé”™è¯¯ä» stderr æ³„æ¼å‡ºæ¥ï¼Œå®šä½æˆæœ¬æŒ‡æ•°çº§ä¸Šå‡

æ²¡æœ‰ mount åé¢„æ£€æ—¶ï¼š
- Buck2 å¤±è´¥è¡¨ç°ä¸º `Error creating cell resolver`ï¼›
- ä½ å¾ˆéš¾ä» API å±‚ç¬¬ä¸€æ—¶é—´åˆ¤æ–­æ˜¯"æŒ‚è½½è§†å›¾è£å‰ª"è¿˜æ˜¯"ä»“åº“ç¼ºæ–‡ä»¶"ã€‚

é¢„æ£€ä¸ç»“æ„åŒ–è¾“å‡ºæœ¬è´¨æ˜¯åœ¨åšï¼š
- **æŠŠä¸å¯æ§å¤±è´¥å‰ç§»ä¸ºå¯æ§å¤±è´¥**ï¼ˆå¯è§£é‡Šã€å¯è¡ŒåŠ¨ï¼‰ã€‚

### 9.3 å‘ 3ï¼šéªŒè¯é“¾è·¯æœ¬èº«ä¹Ÿéœ€è¦å·¥ç¨‹åŒ–ï¼ˆç½‘ç»œ/ä»£ç†/å¹³å°ï¼‰

è¿™æ¬¡éªŒè¯çš„æœ€å¤§é˜»åŠ›æ¥è‡ª"ç¯å¢ƒä¸ç¡®å®šæ€§"ï¼š

- Docker daemon ä¸ shell çš„ä»£ç†é…ç½®ä¸åŒæ­¥ï¼›
- é•œåƒæº DNS ä¸ç¨³å®šï¼›
- é•œåƒ manifest ä¸å¹³å°ä¸ä¸€è‡´ã€‚

ç»éªŒï¼šå¯¹ infra-heavy çš„ç³»ç»Ÿï¼Œ**"å¯é‡å¤éªŒè¯"æœ¬èº«å°±æ˜¯åŠŸèƒ½çš„ä¸€éƒ¨åˆ†**ã€‚

---

## 10. åç»­è¡ŒåŠ¨é¡¹ï¼ˆP0/P1/P2ï¼‰

### P0ï¼ˆå¿…é¡»åš/å°½å¿«ï¼‰

- **æŠŠå¥‘çº¦å†™æ­»åœ¨æ–‡æ¡£ä¸é”™è¯¯ä¿¡æ¯é‡Œ**ï¼š`mount_path å¿…é¡»æ˜¯ Buck2 project rootï¼ˆåŒ…å« .buckconfigï¼‰`ã€‚
- **ä¸Šçº¿åè¯æ®é—­ç¯**ï¼šæ—¥å¿—/æŒ‡æ ‡è®°å½•ï¼š
  - `mount_path`ã€`mount_point`
  - `.buckconfig` æ˜¯å¦å­˜åœ¨
  - `buck2 cells` readiness æˆåŠŸ/å¤±è´¥åŸå› 

### P1ï¼ˆå¼ºçƒˆå»ºè®®ï¼‰

- **è¡¥æœ€å° E2E å›å½’**ï¼šstaging æ¯æ—¥å®šæ—¶è·‘ä¸€æ¬¡ "mount + buck2 cells + targets"ã€‚
- **å­—æ®µæ‹†åˆ†ææ¡ˆ**ï¼ˆä»æ ¹ä¸Šæ¶ˆç­æ­§ä¹‰ï¼‰ï¼š
  - `buck_root`ï¼ˆå¿…é¡»åŒ…å« `.buckconfig`ï¼‰
  - `work_subdir`ï¼ˆå¯é€‰ï¼šä¸šåŠ¡è¦æ“ä½œçš„å­ç›®å½•ï¼‰

### P2ï¼ˆä¼˜åŒ–æ–¹å‘ï¼‰

- **Cargo/Docker çš„ç½‘ç»œä¸ç¼“å­˜æ²»ç†**ï¼š
  - cargoï¼šä»£ç†/é•œåƒæºçš„æ ‡å‡†åŒ–é…ç½®ä¸ CI ç¼“å­˜
  - dockerï¼šdaemon proxy/mirror çš„æ ‡å‡†åŒ–ä¸å¹³å°é•œåƒç­–ç•¥ï¼ˆmanifestï¼‰

---

## 11. é™„å½•

### 11.1 å…³é”®ä¿¡æ¯é€ŸæŸ¥

- **åŸºç¡€ commit**ï¼š`ff49ba8365e2a4529f539f1327ad796c4e20090f`
- **ä¿®å¤åˆ†æ”¯**ï¼š`fix/buck2-mount-root`
- **å…³é”®æäº¤ï¼ˆèŠ‚é€‰ï¼‰**ï¼š
  - `dec83222a`ï¼šæ­¢è¡€ä¿®å¤ï¼ˆå¼ºåˆ¶æŒ‚ `/`ï¼‰
  - `93676c509`ï¼šè¯­ä¹‰ä¸€è‡´åŒ–æ”¹é€ è½åœ°åçš„ä¸»æäº¤ï¼ˆè§ transcript è®°å½•ï¼‰
  - `92da7e8b0`ï¼šä¿®å¤ `BuildDTO::from()` çš„ move/clone ç¼–è¯‘é—®é¢˜ï¼ˆæµ‹è¯•è¿‡ç¨‹ä¸­å‘ç°ï¼‰

> æ³¨ï¼šæäº¤å·ä»¥ transcript è®°è½½ä¸ºå‡†ï¼›è‹¥éœ€è¦åœ¨æœ€ç»ˆ PR æè¿°ä¸­å¯¹é½"ç²¾ç¡® commit åˆ—è¡¨"ï¼Œå»ºè®®ç”¨ `git log --oneline --decorate` å†åšä¸€æ¬¡ç¡®è®¤ä¸è¡¥å…¨ã€‚

### 11.2 ç›¸å…³å‚è€ƒ

- å‚è€ƒå†™ä½œé£æ ¼ï¼š[æ·±åº¦å¤ç›˜ï¼šDicfuse æµ‹è¯•è¶…æ—¶é—®é¢˜è°ƒè¯•å…¨è®°å½•](https://jerry609.github.io/blog/dicfuse-test-timeout-debugging/)
- åŒç›®å½•ç›¸å…³æ–‡æ¡£ï¼š
  - `DICFUSE_ANTARES_BUCK2_CONCURRENCY_POSTMORTEM.md`
  - `ANTARES_BUCK2_CONCURRENCY_PERF_ANALYSIS.md`

---

## 12. è¡¥å……ï¼šæ›´æ·±å±‚çš„å‘ä¸æ–¹æ³•è®º

> æœ¬èŠ‚æ˜¯å¯¹ç¬¬ 9 èŠ‚"å‘ä¸æ•™è®­"çš„è¿›ä¸€æ­¥å±•å¼€ï¼Œè¡¥å……æ›´å¤šè°ƒè¯•è¿‡ç¨‹ä¸­çš„ç»†èŠ‚å’Œå¯è¿ç§»ç»éªŒã€‚

### 12.1 æ„å¤–å‘ç°çš„ç¼–è¯‘ Bugï¼š`BuildDTO::from()` move/clone

åœ¨å•å…ƒæµ‹è¯•é˜¶æ®µï¼Œå‘ç°äº†ä¸€ä¸ªä¸æœ¬æ¬¡ä¿®å¤æ— ç›´æ¥å…³ç³»ã€ä½†è¢«é‡æ„è§¦å‘çš„ç¼–è¯‘é—®é¢˜ï¼š

```rust
// åŸä»£ç ï¼ˆç¼–è¯‘å¤±è´¥ï¼‰
impl From<BuildModel> for BuildDTO {
    fn from(model: BuildModel) -> Self {
        Self {
            // ... å…¶ä»–å­—æ®µ ...
            mount_path: model.repo,  // model.repo è¢« move
            // ... åé¢åˆç”¨äº† model.xxx ...  â† ç¼–è¯‘é”™è¯¯ï¼švalue borrowed after move
        }
    }
}

// ä¿®å¤åï¼ˆcommit 92da7e8b0ï¼‰
impl From<BuildModel> for BuildDTO {
    fn from(model: BuildModel) -> Self {
        Self {
            // ...
            mount_path: model.repo.clone(),  // æ˜¾å¼ cloneï¼Œé¿å… move
            // ...
        }
    }
}
```

> **æ•™è®­**ï¼šé‡æ„å­—æ®µåæ—¶ï¼Œè¦å…³æ³¨æ‰€æœ‰ä½¿ç”¨è¯¥å­—æ®µçš„ `impl From`ã€`Into`ã€`Clone` ç­‰ trait å®ç°ï¼ŒRust çš„ move è¯­ä¹‰ä¼šåœ¨æ„æƒ³ä¸åˆ°çš„åœ°æ–¹å’¬ä½ ã€‚

### 12.2 Docker ç¯å¢ƒè¸©å‘å…¨è®°å½•

è¿™æ¬¡ E2E éªŒè¯çš„ç¯å¢ƒé—®é¢˜å€¼å¾—å•ç‹¬è®°å½•ï¼Œå› ä¸ºæ¯ä¸€æ­¥éƒ½æ˜¯"ä»¥ä¸ºèƒ½è·‘å´è·‘ä¸åŠ¨"ï¼š

| é˜¶æ®µ | æœŸæœ› | å®é™… | è§£å†³æ–¹æ¡ˆ |
|------|------|------|----------|
| **é•œåƒæ‹‰å–** | `docker compose up -d` ç›´æ¥è·‘ | Docker Hub è¶…æ—¶ï¼ˆ30s æ— æ•°æ®ï¼‰ | - |
| **åŠ é€Ÿå™¨ 1** | é…ç½®ä¸­ç§‘å¤§é•œåƒ `mirrors.ustc.edu.cn` | DNS è§£æå¤±è´¥ | - |
| **åŠ é€Ÿå™¨ 2** | æ¢ç½‘æ˜“é•œåƒ `hub-mirror.c.163.com` | åŒæ · DNS å¤±è´¥ | - |
| **ç›´è¿è¯Šæ–­** | `curl registry-1.docker.io` | å‘ç°ç³»ç»Ÿæœ‰ä»£ç† `127.0.0.1:7897`ï¼Œä½† Docker æ²¡ç”¨å®ƒ | é…ç½® Docker daemon proxy |
| **ä»£ç†é…ç½®** | ä¸º Docker systemd æ·»åŠ  `HTTP_PROXY` | é…ç½®ç”Ÿæ•ˆï¼Œé•œåƒæ‹‰å–æˆåŠŸ | âœ… |
| **ç«¯å£å†²çª** | å®¹å™¨å¯åŠ¨ | 6379 ç«¯å£è¢«å ç”¨ | æ¸…ç†æ—§å®¹å™¨/é‡å¯ Docker |
| **é•œåƒ manifest** | è¿è¡ŒæœåŠ¡ | æŸäº›é•œåƒä¸åŒ…å«å½“å‰å¹³å° manifest | é‡‡ç”¨"Compose ä¾èµ– + æœ¬åœ°æœåŠ¡"æŠ˜ä¸­ |

<details>
<summary><b>ğŸ”§ Docker ä»£ç†é…ç½®å‘½ä»¤å¤‡å¿˜ï¼ˆç‚¹å‡»å±•å¼€ï¼‰</b></summary>

```bash
# 1. åˆ›å»º Docker systemd ä»£ç†é…ç½®
sudo mkdir -p /etc/systemd/system/docker.service.d
sudo tee /etc/systemd/system/docker.service.d/http-proxy.conf << 'EOF'
[Service]
Environment="HTTP_PROXY=http://127.0.0.1:7897"
Environment="HTTPS_PROXY=http://127.0.0.1:7897"
Environment="NO_PROXY=localhost,127.0.0.1,172.16.0.0/12,192.168.0.0/16,10.0.0.0/8"
EOF

# 2. é‡è½½é…ç½®å¹¶é‡å¯ Docker
sudo systemctl daemon-reload
sudo systemctl restart docker

# 3. éªŒè¯ä»£ç†é…ç½®
docker info 2>&1 | grep -A 2 -i proxy
```

</details>

<details>
<summary><b>ğŸ”§ Cargo ä»£ç†é…ç½®å‘½ä»¤å¤‡å¿˜ï¼ˆç‚¹å‡»å±•å¼€ï¼‰</b></summary>

```bash
# æ–¹æ³• 1ï¼šç¯å¢ƒå˜é‡ï¼ˆä¸´æ—¶ï¼‰
export HTTP_PROXY=http://127.0.0.1:7897
export HTTPS_PROXY=http://127.0.0.1:7897
export ALL_PROXY=http://127.0.0.1:7897
export CARGO_HTTP_TIMEOUT=600  # å¢åŠ è¶…æ—¶æ—¶é—´

cargo fetch  # å…ˆæ‹‰ä¾èµ–
cargo check -p orion -p orion-server

# æ–¹æ³• 2ï¼šCargo é…ç½®ï¼ˆæ°¸ä¹…ï¼‰
# ~/.cargo/config.toml
[http]
proxy = "http://127.0.0.1:7897"
timeout = 600

[net]
git-fetch-with-cli = true
```

</details>

> **æ•™è®­**ï¼šWSL ç¯å¢ƒä¸‹ï¼Œå®¿ä¸»æœºä»£ç†å’Œ Docker daemon ä»£ç†æ˜¯ä¸¤å¥—é…ç½®ï¼Œéœ€è¦åˆ†åˆ«å¤„ç†ã€‚Shell èƒ½ç”¨ä»£ç†ä¸ä»£è¡¨ Docker èƒ½ç”¨ã€‚

### 12.3 å‡è®¾-éªŒè¯å¾ªç¯çš„è¯¦ç»†å±•å¼€

æœ¬æ¬¡è°ƒè¯•ä¸­ï¼Œå‡è®¾-éªŒè¯å¾ªç¯æ˜¯å®šä½æ ¹å› çš„å…³é”®æ–¹æ³•ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å‡è®¾-éªŒè¯å¾ªç¯                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  å‡è®¾ H1: .buckconfig åœ¨ä»“åº“æ ¹ï¼Œä½† mountpoint çœ‹ä¸åˆ°å®ƒ                   â”‚
â”‚    â”‚                                                                    â”‚
â”‚    â””â”€ éªŒè¯æ–¹æ³•: æ£€æŸ¥ Buck2 stderr                                        â”‚
â”‚       â””â”€ è¯æ®: "Expected to find a .buckconfig file" âœ“                  â”‚
â”‚                                                                         â”‚
â”‚  å‡è®¾ H2: mountpoint çœ‹ä¸åˆ°æ˜¯å› ä¸º mount ä¼ å‚æ˜¯å­ç›®å½•è§†å›¾                  â”‚
â”‚    â”‚                                                                    â”‚
â”‚    â””â”€ éªŒè¯æ–¹æ³•: è¯»å– scorpio/antares.rs normalize_mount_path()           â”‚
â”‚       â””â”€ è¯æ®: Antares ç¡®å®æ”¯æŒ"å­ç›®å½•è§†å›¾è£å‰ª" âœ“                        â”‚
â”‚                                                                         â”‚
â”‚  å‡è®¾ H3: å¼ºåˆ¶æŒ‚è½½ "/" èƒ½è§£å†³é—®é¢˜                                        â”‚
â”‚    â”‚                                                                    â”‚
â”‚    â””â”€ éªŒè¯æ–¹æ³•: commit dec83222a åé‡æ–°æµ‹è¯•                              â”‚
â”‚       â””â”€ è¯æ®: Buck2 ä¸å†æŠ¥é”™ âœ“                                          â”‚
â”‚       â””â”€ ä½†å¼•å…¥æ–°é—®é¢˜: è¯­ä¹‰å˜åŒ–ï¼Œéœ€è¦ç»§ç»­è¿­ä»£                             â”‚
â”‚                                                                         â”‚
â”‚  å‡è®¾ H4: ç§»é™¤ fallbackã€å¢åŠ é¢„æ£€ã€æ˜ç¡®æŠ¥é”™èƒ½å…¼é¡¾é²æ£’æ€§å’Œè¯­ä¹‰ä¸€è‡´æ€§       â”‚
â”‚    â”‚                                                                    â”‚
â”‚    â””â”€ éªŒè¯æ–¹æ³•: å•å…ƒæµ‹è¯•                                                 â”‚
â”‚       â””â”€ è¯æ®: orion 43/43 + orion-server 6/6 å…¨è¿‡ âœ“                    â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> **æ•™è®­**ï¼šä¸è¦è·³è¿‡å‡è®¾ç›´æ¥æ”¹ä»£ç ã€‚æ¯ä¸€æ­¥ä¿®æ”¹éƒ½åº”è¯¥æœ‰æ˜ç¡®çš„å‡è®¾å’ŒéªŒè¯è¯æ®ã€‚"æ”¹å¯¹äº†"å’Œ"çŸ¥é“ä¸ºä»€ä¹ˆæ”¹å¯¹äº†"æ˜¯ä¸¤å›äº‹ã€‚

### 12.4 åŸå§‹é”™è¯¯æ—¥å¿—ï¼ˆä¾›å¤ç°å‚è€ƒï¼‰

```text
Error getting build targets: Fail to get cells: Buck2 stderr: Command failed: Error creating cell resolver 

Caused by: 

    Couldn't find a buck project root for directory 
    `/tmp/scorpio-megadir/antares/mnt/10916897-2fd6-4f5b-9218-3fc2618b349f`. 
    Expected to find a .buckconfig file.
```

å…³é”®ä¿¡æ¯è§£è¯»ï¼š
- **UUID è·¯å¾„**ï¼š`10916897-2fd6-4f5b-9218-3fc2618b349f` æ˜¯ Antares ä¸ºæ¯æ¬¡æŒ‚è½½ç”Ÿæˆçš„å”¯ä¸€æ ‡è¯†
- **è·¯å¾„å±‚çº§**ï¼š`/tmp/scorpio-megadir/antares/mnt/` æ˜¯ Scorpio FUSE çš„æ ‡å‡†æŒ‚è½½ç‚¹å‰ç¼€
- **é”™è¯¯è§¦å‘ç‚¹**ï¼š`Error creating cell resolver` è¡¨æ˜å¤±è´¥å‘ç”Ÿåœ¨ Buck2 åˆå§‹åŒ–é˜¶æ®µï¼Œè€Œéæ„å»ºé˜¶æ®µ

### 12.5 å•å…ƒæµ‹è¯•ç»“æœè¯¦æƒ…

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æµ‹è¯•éªŒè¯ç»“æœ                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  orion (build agent)                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                              â”‚
â”‚  $ cargo test --lib                                 â”‚
â”‚  running 43 tests                                   â”‚
â”‚  test result: ok. 43 passed; 0 failed               â”‚
â”‚                                                     â”‚
â”‚  è¦†ç›–èŒƒå›´ï¼š                                          â”‚
â”‚  - MountGuard ç”Ÿå‘½å‘¨æœŸ                               â”‚
â”‚  - normalize_mount_path() è¾¹ç•Œæƒ…å†µ                   â”‚
â”‚  - Antares FS mount/unmount                         â”‚
â”‚  - Buck2 targets è§£æ                               â”‚
â”‚                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  orion-server (API å±‚)                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                              â”‚
â”‚  $ cargo test --lib                                 â”‚
â”‚  running 6 tests                                    â”‚
â”‚  test result: ok. 6 passed; 0 failed                â”‚
â”‚                                                     â”‚
â”‚  è¦†ç›–èŒƒå›´ï¼š                                          â”‚
â”‚  - TaskRequest åºåˆ—åŒ–/ååºåˆ—åŒ–                       â”‚
â”‚  - BuildDTO å­—æ®µæ˜ å°„                                 â”‚
â”‚  - API é‡è¯•é€»è¾‘                                      â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 13. æ€è€ƒï¼šä»è¿™ä¸ªæ¡ˆä¾‹èƒ½å­¦åˆ°ä»€ä¹ˆï¼Ÿ

### 13.1 å…³äº"æ­¢è¡€"ä¸"æ ¹æ²»"

- **æ­¢è¡€**ï¼šå¿«é€Ÿæ¢å¤ç³»ç»Ÿå¯ç”¨æ€§ï¼ˆå¼ºåˆ¶æŒ‚è½½ `/`ï¼‰
- **æ ¹æ²»**ï¼šæ¶ˆé™¤éšæ‚£ã€ç»Ÿä¸€è¯­ä¹‰ã€å¢åŠ é¢„æ£€

ä¸¤è€…ä¸çŸ›ç›¾ï¼Œä½†**æ­¢è¡€ä¸èƒ½æ›¿ä»£æ ¹æ²»**ã€‚æ­¢è¡€æ˜¯ä¸ºäº†äº‰å–æ—¶é—´ï¼Œæ ¹æ²»æ‰æ˜¯çœŸæ­£è§£å†³é—®é¢˜ã€‚

### 13.2 å…³äº"éšå¼å…œåº•"

"éšå¼ fallback"çœ‹ä¼¼å‹å¥½ï¼Œå®åˆ™æ˜¯**æŠ€æœ¯å€ºçš„æ¸©åºŠ**ï¼š
- æ©ç›–äº†ä¸Šæ¸¸çš„é”™è¯¯
- è®©ç³»ç»Ÿè¡Œä¸ºéš¾ä»¥é¢„æµ‹
- åœ¨è¾¹ç•Œåœºæ™¯ä¼šåå™¬

æ„å»ºç³»ç»Ÿè¿™ç±»"æ­£ç¡®æ€§ä¼˜å…ˆ"çš„åœºæ™¯ï¼Œ**å®å¯æ˜ç¡®å¤±è´¥ï¼Œä¹Ÿä¸è¦é™é»˜æˆåŠŸä½†è¯­ä¹‰é”™ä¹±**ã€‚

### 13.3 å…³äº"å¯é‡å¤éªŒè¯"

è¿™æ¬¡ E2E éªŒè¯å—é˜»çš„ä¸»è¦åŸå› æ˜¯**ç¯å¢ƒä¸ä¸€è‡´**ï¼š
- ä»£ç†é…ç½®ä¸åŒæ­¥
- é•œåƒæºä¸å¯ç”¨
- å¹³å°/manifest ä¸åŒ¹é…

å¯¹ infra-heavy çš„ç³»ç»Ÿï¼Œ**"å¯é‡å¤éªŒè¯"æœ¬èº«å°±æ˜¯åŠŸèƒ½çš„ä¸€éƒ¨åˆ†**ã€‚æ²¡æœ‰å¯é çš„éªŒè¯ç¯å¢ƒï¼Œä¿®å¤å°±æ— æ³•é—­ç¯ã€‚

---

*æ–‡æ¡£æ›´æ–°æ—¥æœŸï¼š2026-01-23*
*ä½œè€…ï¼šåŸºäº agent transcript è‡ªåŠ¨ç”Ÿæˆ*
