---
title: 'Claude Code å·¥å…·ç³»ç»Ÿï¼šå†…ç½®å·¥å…·çš„å®ç°å‰–æ'
description: 'æ·±å…¥è§£æ Claude Code çš„å†…ç½®å·¥å…·ç³»ç»Ÿï¼ŒåŒ…æ‹¬ Bashã€Grepã€Globã€Readã€Writeã€Edit ç­‰æ ¸å¿ƒå·¥å…·çš„è®¾è®¡ç†å¿µä¸å®ç°ç»†èŠ‚ã€‚'
publishDate: '2025-12-06'
tags: ['Claude', 'Agent', 'æºç åˆ†æ', 'Tools', 'Python']
language: 'zh-CN'
draft: true
---

> Claude Code ä½œä¸º Anthropic æ¨å‡ºçš„ Agentic ç¼–ç¨‹å·¥å…·ï¼Œå…¶æ ¸å¿ƒèƒ½åŠ›åœ¨äºä¸€å¥—ç²¾å¿ƒè®¾è®¡çš„**å†…ç½®å·¥å…·ç³»ç»Ÿ**ã€‚æœ¬æ–‡ä¼šä»åè®®å±‚å’Œå®ç°å±‚ä¸¤ä¸ªè§’åº¦ï¼Œå‰–æè¿™äº›å·¥å…·çš„è®¾è®¡ç†å¿µä¸å·¥ç¨‹å–èˆã€‚

æœ¬æ–‡ä¸»è¦æƒ³å›ç­”ä¸‰ä¸ªé—®é¢˜ï¼š

1. ä» LLM è§†è§’çœ‹ï¼Œ*â€œè°ƒç”¨å·¥å…·â€* åœ¨åè®®å±‚é¢åˆ°åº•é•¿ä»€ä¹ˆæ ·ï¼Ÿ
2. Claude Code ä¸ºä»€ä¹ˆè¦ç”¨ä¸€æ•´å¥—ä¸“ç”¨å·¥å…·æ›¿ä»£ `bash` å‘½ä»¤ï¼Ÿ
3. è¿™äº›å†…ç½®å·¥å…·åœ¨å®ç°ä¸Šåšäº†å“ªäº›ã€Œä¸º LLM ä¼˜åŒ–ã€çš„å·¥ç¨‹å†³ç­–ï¼Ÿ

---

## ä¸€ã€å·¥å…·ç³»ç»Ÿæ¦‚è§ˆ

Claude Code æä¾›äº†ä¸€å¥—ä¸“é—¨ä¸ºä»£ç å¼€å‘åœºæ™¯ä¼˜åŒ–çš„å†…ç½®å·¥å…·ï¼Œå¤§è‡´å¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼š

| ç±»åˆ« | å·¥å…· | ç”¨é€” |
|:-----|:-----|:-----|
| **æ–‡ä»¶è¯»å–** | `Read`, `Glob`, `Grep`, `LS` | è¯»å–ã€æœç´¢ã€åˆ—å‡ºæ–‡ä»¶ |
| **æ–‡ä»¶å†™å…¥** | `Write`, `Edit`, `MultiEdit` | åˆ›å»ºã€ä¿®æ”¹æ–‡ä»¶ |
| **å‘½ä»¤æ‰§è¡Œ** | `Bash` | æ‰§è¡Œ Shell å‘½ä»¤ |

è¿™äº›å·¥å…·çš„è®¾è®¡éµå¾ªä¸€ä¸ªæ ¸å¿ƒåŸåˆ™ï¼š**ç”¨ä¸“ç”¨å·¥å…·æ›¿ä»£é€šç”¨ Bash å‘½ä»¤**ï¼Œä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½ã€å®‰å…¨æ€§å’Œå¯æ§æ€§ã€‚

> ç³»åˆ—ç›¸å…³æ–‡ç« ï¼š
> - æœ¬æ–‡ï¼š**Claude Code å·¥å…·ç³»ç»Ÿï¼šå†…ç½®å·¥å…·çš„å®ç°å‰–æ**ï¼ˆå·¥å…·è®¾è®¡ä¸å®ç°ç»†èŠ‚ï¼‰
> - ä¸‹ä¸€ç¯‡ï¼š**[ç”¨ Google ADK å¤ç° Claude Code å·¥å…·ç³»ç»Ÿ](/blog/adk-replicate-claude-code-tools/)**ï¼ˆç”¨ ADK ä»é›¶å®ç°ä¸€å¥—ç±»ä¼¼å·¥å…·ï¼‰
> - å»¶ä¼¸é˜…è¯»ï¼š**[Claude Agent SDK vs Google ADKï¼šä¸¤ç§ Agent å¼€å‘èŒƒå¼çš„æ·±åº¦å¯¹æ¯”](/blog/claude-sdk-vs-google-adk-1/)**ï¼ˆä» SDK è§†è§’çœ‹ä¸¤å®¶ç”Ÿæ€ï¼‰

---

## äºŒã€LLM å¦‚ä½•ã€Œè°ƒç”¨ã€å·¥å…·

åœ¨æ·±å…¥å…·ä½“å·¥å…·ä¹‹å‰ï¼Œå…ˆæŠŠæ ¸å¿ƒåè®®è¯´æ¸…æ¥šï¼š**LLM ä¸æ‰§è¡Œå·¥å…·ï¼Œå®ƒåªç”Ÿæˆç»“æ„åŒ–çš„è°ƒç”¨æè¿°ï¼Œç”±å®¢æˆ·ç«¯è§£æå¹¶æ‰§è¡Œã€‚**

ä»æŠ½è±¡ä¸Šçœ‹ï¼Œè¿™å°±æ˜¯ä¸€å±‚ RPC over JSONï¼š

- å®¢æˆ·ç«¯ï¼šå£°æ˜å¯ç”¨ã€Œæ–¹æ³•ã€ï¼ˆtools + schemaï¼‰
- LLMï¼šè¿”å›ã€Œè¦è°ƒç”¨çš„æ–¹æ³•å + å‚æ•°ã€
- å®¢æˆ·ç«¯ï¼šæœ¬åœ°æ‰§è¡Œï¼Œå†æŠŠç»“æœä½œä¸ºæ–°çš„æ¶ˆæ¯å›ä¼ 

### 2.1 å®Œæ•´æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   1. å‘é€è¯·æ±‚     â”‚ â”€â”€â–¶ â”‚   2. LLM ç”Ÿæˆ     â”‚ â”€â”€â–¶ â”‚  3. å®¢æˆ·ç«¯æ‰§è¡Œ    â”‚
â”‚   (å¸¦å·¥å…·å®šä¹‰)    â”‚     â”‚   (ç»“æ„åŒ– JSON)   â”‚     â”‚  (çœŸæ­£è°ƒç”¨å·¥å…·)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 å®¢æˆ·ç«¯å‘é€è¯·æ±‚ï¼ˆå¸¦å·¥å…· Schemaï¼‰

å®¢æˆ·ç«¯å‘Šè¯‰ LLMï¼šã€Œä½ å¯ä»¥ç”¨è¿™äº›å·¥å…·ï¼Œå‚æ•°æ ¼å¼æ˜¯è¿™æ ·çš„ã€‚ã€

```typescript
// å‘é€ç»™ Anthropic API çš„è¯·æ±‚ï¼ˆç®€åŒ–ï¼‰
{
  "model": "claude-sonnet-4-20250514",
  "messages": [
    { "role": "user", "content": "æŸ¥æ‰¾åŒ…å« useState çš„æ–‡ä»¶" }
  ],
  "tools": [                          // â† å·¥å…·å®šä¹‰ï¼ˆJSON Schemaï¼‰
    {
      "name": "GrepTool",
      "description": "æœç´¢æ–‡ä»¶å†…å®¹...",
      "input_schema": {               // â† å‘Šè¯‰ LLM å‚æ•°æ ¼å¼
        "type": "object",
        "properties": {
          "pattern": { "type": "string", "description": "æ­£åˆ™è¡¨è¾¾å¼" },
          "path": { "type": "string", "description": "æœç´¢ç›®å½•" },
          "include": { "type": "string", "description": "æ–‡ä»¶è¿‡æ»¤" }
        },
        "required": ["pattern"]
      }
    }
  ]
}
```

å¦‚æœæŠ½æ‰ç»†èŠ‚ï¼Œå¯ä»¥å‹ç¼©æˆä¸€ä¸ªæç®€ä¼ªä»£ç ç‰ˆï¼š

```ts
callLLM({
  tools: [ ToolSchema... ],
  messages: [...]
})

// LLM è¿”å›ï¼š
assistant: tool_use(name="GrepTool", input={...})

// å®¢æˆ·ç«¯ï¼š
result = GrepTool.call(input)
sendToLLM(tool_result(result))
```

### 2.3 LLM ç”Ÿæˆç»“æ„åŒ–è¾“å‡ºï¼ˆä¸æ˜¯æ‰§è¡Œï¼‰

LLM çœ‹åˆ°å·¥å…·å®šä¹‰åï¼Œ**é€‰æ‹©è¦è°ƒç”¨çš„å·¥å…·**ï¼Œå¹¶**ç”Ÿæˆç¬¦åˆ schema çš„ JSON å‚æ•°**ï¼š

```json
{
  "role": "assistant",
  "content": [
    {
      "type": "tool_use",              // â† ç‰¹æ®Šçš„æ¶ˆæ¯ç±»å‹
      "id": "toolu_01ABC123",          // â† å”¯ä¸€ IDï¼ˆç”¨äºåŒ¹é…ç»“æœï¼‰
      "name": "GrepTool",              // â† LLM é€‰æ‹©çš„å·¥å…·å
      "input": {                       // â† LLM ç”Ÿæˆçš„å‚æ•°ï¼ˆç¬¦åˆ schemaï¼‰
        "pattern": "useState",
        "include": "*.tsx"
      }
    }
  ],
  "stop_reason": "tool_use"            // â† è¡¨ç¤ºéœ€è¦å·¥å…·ç»“æœæ‰èƒ½ç»§ç»­
}
```

è¿™é‡Œæœ€é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼š**LLM åªæ˜¯æè¿°ã€Œæˆ‘è¦è°ƒç”¨ä»€ä¹ˆ + å‚æ•°æ˜¯ä»€ä¹ˆã€è¿™ä»¶äº‹ï¼Œæœ¬èº«ä¸è§¦ç¢°ä»»ä½•ç³»ç»Ÿèµ„æºã€‚**

### 2.4 å®¢æˆ·ç«¯è§£æå¹¶æ‰§è¡Œ

å®¢æˆ·ç«¯æ”¶åˆ°å“åº”åï¼Œè§£æ `tool_use` å—ï¼Œæ‰¾åˆ°æœ¬åœ°å®ç°å¹¶çœŸæ­£è°ƒç”¨ï¼š

```typescript
// å¤„ç†é€»è¾‘ï¼ˆä¼ªä»£ç ï¼‰
for (const block of assistantMessage.content) {
  if (block.type === 'tool_use') {
    const toolName = block.name      // "GrepTool"
    const toolInput = block.input    // { pattern: "useState", include: "*.tsx" }
    const toolUseId = block.id       // "toolu_01ABC123"
    
    // 1. æŸ¥æ‰¾å¯¹åº”çš„å·¥å…·å®ç°
    const tool = tools.find(t => t.name === toolName)
    
    // 2. éªŒè¯å‚æ•°
    const isValid = tool.inputSchema.safeParse(toolInput)
    
    // 3. çœŸæ­£æ‰§è¡Œå·¥å…·ä»£ç 
    for await (const result of tool.call(toolInput, context)) {
      // GrepTool.call() å†…éƒ¨å¯èƒ½æ˜¯å¯¹ ripgrep çš„ä¸€å±‚å°è£…
    }
    
    // 4. æŠŠç»“æœè¿”å›ç»™ LLM
    yield createUserMessage([{
      type: 'tool_result',
      tool_use_id: toolUseId,        // â† åŒ¹é…ä¹‹å‰çš„ tool_use
      content: "Found 15 files\n..."
    }])
  }
}
```

### 2.5 å°†ç»“æœè¿”å›ç»™ LLM

å·¥å…·æ‰§è¡Œå®Œæˆåï¼Œç»“æœä½œä¸ºæ–°ä¸€è½®è¯·æ±‚çš„ä¸€éƒ¨åˆ†å‘é€ç»™ LLMï¼š

```typescript
// ä¸‹ä¸€è½® API è¯·æ±‚ï¼ˆç®€åŒ–ï¼‰
{
  "messages": [
    { "role": "user", "content": "æŸ¥æ‰¾åŒ…å« useState çš„æ–‡ä»¶" },
    { 
      "role": "assistant", 
      "content": [
        { "type": "tool_use", "id": "toolu_01ABC123", "name": "GrepTool", "input": {...} }
      ]
    },
    { 
      "role": "user",                  // â† tool_result åœ¨åè®®é‡Œæ˜¯ user è§’è‰²
      "content": [
        {
          "type": "tool_result",
          "tool_use_id": "toolu_01ABC123",
          "content": "Found 15 files\nsrc/App.tsx\nsrc/hooks/useAuth.tsx\n..."
        }
      ]
    }
  ]
}
```

LLM æ”¶åˆ° `tool_result` åï¼Œå†ç»§ç»­ç”Ÿæˆè‡ªç„¶è¯­è¨€å›å¤æˆ–ä¸‹ä¸€è½® `tool_use`ã€‚

### 2.6 å°ç»“ï¼šèŒè´£è¾¹ç•Œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                     â”‚
â”‚   LLM çš„èƒ½åŠ›è¾¹ç•Œï¼š                                                   â”‚
â”‚                                                                     â”‚
â”‚   1. é˜…è¯»å·¥å…·å®šä¹‰ï¼ˆJSON Schemaï¼‰                                     â”‚
â”‚   2. å†³å®šæ˜¯å¦éœ€è¦è°ƒç”¨å·¥å…·                                            â”‚
â”‚   3. ç”Ÿæˆç¬¦åˆ schema çš„ JSON å‚æ•°                                    â”‚
â”‚   4. ç­‰å¾…å®¢æˆ·ç«¯è¿”å› tool_result                                      â”‚
â”‚   5. æ ¹æ®ç»“æœç»§ç»­ç”Ÿæˆå›å¤                                            â”‚
â”‚                                                                     â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚                                                                     â”‚
â”‚   å®¢æˆ·ç«¯è´Ÿè´£å®é™…ã€Œæ‰§è¡Œã€ï¼š                                           â”‚
â”‚                                                                     â”‚
â”‚   1. è§£æ LLM è¿”å›çš„ tool_use JSON                                   â”‚
â”‚   2. æ‰¾åˆ°å¯¹åº”çš„å·¥å…·å®ç°                                              â”‚
â”‚   3. è°ƒç”¨ tool.call(input, context) æ‰§è¡Œ                            â”‚
â”‚   4. å°†ç»“æœå°è£…ä¸º tool_result è¿”å›ç»™ LLM                             â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

æœ¬è´¨ä¸Šï¼Œå·¥å…·è°ƒç”¨å°±æ˜¯ï¼š**è®© LLM ç”¨å—çº¦æŸçš„ç»“æ„åŒ–æ ¼å¼ï¼Œè¡¨è¾¾ä¸€ç±»ã€ŒRPC è°ƒç”¨ã€çš„æ„å›¾**ã€‚

### 2.7 å®Œæ•´å®ä¾‹ï¼šä»ç”¨æˆ·è¾“å…¥åˆ°æœ€ç»ˆå“åº”

ç”¨ä¸€ä¸ªå…·ä½“ä¾‹å­èµ°å®Œæ•´ä¸ªå…³é”®è·¯å¾„ï¼š

**åœºæ™¯**ï¼šç”¨æˆ·è¾“å…¥ã€Œå¸®æˆ‘æ‰¾å‡ºæ‰€æœ‰åŒ…å« useState çš„ React æ–‡ä»¶ã€ã€‚

#### Step 1: ç”¨æˆ·è¾“å…¥ â†’ CLI æ„é€ è¯·æ±‚

```text
ç”¨æˆ·åœ¨ç»ˆç«¯è¾“å…¥:
> å¸®æˆ‘æ‰¾å‡ºæ‰€æœ‰åŒ…å« useState çš„ React æ–‡ä»¶
```

CLI å°†ç”¨æˆ·è¾“å…¥åŒ…è£…æˆ messagesï¼Œå¹¶é™„ä¸Šå·¥å…·å®šä¹‰ï¼š

```typescript
// CLI å‘é€ç»™ Anthropic API çš„è¯·æ±‚ï¼ˆç®€åŒ–ï¼‰
{
  "model": "claude-sonnet-4-20250514",
  "max_tokens": 16000,
  "system": "You are Claude Code, an AI assistant...",
  "messages": [
    {
      "role": "user",
      "content": "å¸®æˆ‘æ‰¾å‡ºæ‰€æœ‰åŒ…å« useState çš„ React æ–‡ä»¶"
    }
  ],
  "tools": [
    {
      "name": "GrepTool",
      "description": "æœç´¢æ–‡ä»¶å†…å®¹...",
      "input_schema": { /* JSON Schema */ }
    },
    // ... æ›´å¤šå·¥å…·
  ],
  "tool_choice": { "type": "auto" }
}
```

#### Step 2: LLM è¿”å› tool_use

```json
{
  "role": "assistant",
  "content": [
    { "type": "text", "text": "æˆ‘æ¥å¸®ä½ æœç´¢åŒ…å« useState çš„ React æ–‡ä»¶ã€‚" },
    {
      "type": "tool_use",
      "id": "toolu_01XYZ",
      "name": "GrepTool",
      "input": {
        "pattern": "useState",
        "path": ".",
        "include": "*.tsx,*.jsx"
      }
    }
  ],
  "stop_reason": "tool_use"
}
```

#### Step 3: CLI æ‰§è¡Œå·¥å…·

```typescript
// CLI å†…éƒ¨å¤„ç†ï¼ˆä¼ªä»£ç ï¼‰
const toolUse = response.content.find(b => b.type === 'tool_use');
const tool = tools.find(t => t.name === toolUse.name);  // GrepTool

// æ‰§è¡Œå·¥å…·ï¼ˆå®é™…è°ƒç”¨ ripgrep çš„å°è£…ï¼‰
const result = await tool.call(toolUse.input, context);
// result.data = [
//   { file: "src/App.tsx", line: 5, content: "useState(0)" },
//   { file: "src/hooks/useAuth.tsx", line: 12, content: "useState(null)" },
// ]
```

#### Step 4: CLI å‘é€ tool_result

```typescript
// CLI å‘é€çš„ç¬¬äºŒè½®è¯·æ±‚
{
  "messages": [
    { "role": "user", "content": "å¸®æˆ‘æ‰¾å‡ºæ‰€æœ‰åŒ…å« useState çš„ React æ–‡ä»¶" },
    { 
      "role": "assistant", 
      "content": [
        { "type": "text", "text": "æˆ‘æ¥å¸®ä½ æœç´¢..." },
        { "type": "tool_use", "id": "toolu_01XYZ", "name": "GrepTool", "input": {...} }
      ]
    },
    { 
      "role": "user",
      "content": [{
        "type": "tool_result",
        "tool_use_id": "toolu_01XYZ",
        "content": "Found 8 matches:\nsrc/App.tsx:5: useState(0)\nsrc/hooks/useAuth.tsx:12: useState(null)\n..."
      }]
    }
  ]
}
```

#### Step 5: LLM ç”Ÿæˆæœ€ç»ˆå›å¤

```json
{
  "role": "assistant",
  "content": [{
    "type": "text",
    "text": "æ‰¾åˆ°äº† 8 ä¸ªåŒ…å« useState çš„ React æ–‡ä»¶ï¼š\n\n1. **src/App.tsx** - ç¬¬ 5 è¡Œ\n2. **src/hooks/useAuth.tsx** - ç¬¬ 12 è¡Œ\n..."
  }],
  "stop_reason": "end_turn"
}
```

#### æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·: "å¸®æˆ‘æ‰¾å‡ºæ‰€æœ‰åŒ…å« useState çš„ React æ–‡ä»¶"                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CLI: æ„é€ è¯·æ±‚ { messages: [...], tools: [...] }                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ HTTP POST
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LLM: è¿”å› { type: "tool_use", name: "GrepTool", input: {...} }    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CLI: æ‰§è¡Œ GrepTool â†’ è°ƒç”¨ ripgrep â†’ å¾—åˆ°ç»“æœ                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CLI: å‘é€ { type: "tool_result", content: "Found 8 matches..." }  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ HTTP POST
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LLM: è¿”å› { type: "text", text: "æ‰¾åˆ°äº† 8 ä¸ªæ–‡ä»¶..." }             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CLI: æ˜¾ç¤ºç»™ç”¨æˆ·                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ã€Tools â†’ LLM API æ•°æ®æµ

ä¸Šé¢æ˜¯åè®®å±‚ï¼Œè¿™ä¸€èŠ‚å¯¹é½åˆ°ã€Œä»£ç åˆ†å±‚ã€è§†è§’ï¼Œçœ‹ Claude Code å·¥å…·ç³»ç»Ÿä»å®šä¹‰åˆ°è°ƒç”¨çš„å®Œæ•´æ•°æ®æµã€‚å¯ä»¥æŠŠå®ƒç†è§£æˆä¸€ä¸ªå…¸å‹çš„ã€ŒTool Registry + Query Engineã€ç»“æ„ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Tool å®šä¹‰å±‚    â”‚
â”‚  src/tools/*      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ æ¯ä¸ªå·¥å…·åŒ…å«:
         â”‚ â€¢ name: string
         â”‚ â€¢ description: string
         â”‚ â€¢ inputSchema: ZodSchema
         â”‚ â€¢ call(): AsyncGenerator
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. Tool èšåˆå±‚                                                        â”‚
â”‚  getAllTools() â†’ è¿”å›æ‰€æœ‰å·¥å…·æ•°ç»„                                      â”‚
â”‚  [TaskTool, BashTool, FileReadTool, FileEditTool, GrepTool, ...]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. æŸ¥è¯¢å¼•æ“ï¼ˆä¾‹å¦‚ query() / runConversation()ï¼‰                       â”‚
â”‚                                                                        â”‚
â”‚  â€¢ ç»´æŠ¤æ¶ˆæ¯å†å²                                                         â”‚
â”‚  â€¢ æ‹¼æ¥ç³»ç»Ÿæç¤º                                                         â”‚
â”‚  â€¢ å†³å®šæ˜¯å¦å…è®¸ä½¿ç”¨å·¥å…·ï¼ˆcanUseTool å›è°ƒï¼‰                              â”‚
â”‚  â€¢ è°ƒç”¨ LLM API å‘é€è¯·æ±‚                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. LLM æœåŠ¡å±‚ï¼ˆå°è£… SDK è°ƒç”¨ï¼‰                                        â”‚
â”‚                                                                        â”‚
â”‚  ğŸ”§ Tool Schema è½¬æ¢                                                    â”‚
â”‚  // Anthropic æ ¼å¼                                                     â”‚
â”‚  const toolSchemas = tools.map(tool => ({                              â”‚
â”‚    name: tool.name,                                                    â”‚
â”‚    description: getToolDescription(tool),                              â”‚
â”‚    input_schema: zodToJsonSchema(tool.inputSchema)                     â”‚
â”‚  }))                                                                   â”‚
â”‚                                                                        â”‚
â”‚  ğŸ“¤ å‘é€ API è¯·æ±‚                                                      â”‚
â”‚  anthropic.messages.create({                                           â”‚
â”‚    model, max_tokens, messages, system,                                â”‚
â”‚    tools: toolSchemas,        â† å·¥å…· schema                            â”‚
â”‚    tool_choice: { type: 'auto' }                                       â”‚
â”‚  })                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. LLM å“åº” â†’ Tool è°ƒç”¨                                               â”‚
â”‚                                                                        â”‚
â”‚  LLM è¿”å› tool_use å—:                                                 â”‚
â”‚  { type: 'tool_use', id: 'xxx', name: 'Bash', input: { command: '...' }}â”‚
â”‚                                                                        â”‚
â”‚  æŸ¥è¯¢å¼•æ“æ‰§è¡Œ:                                                          â”‚
â”‚  1. æŸ¥æ‰¾å·¥å…·: tool = tools.find(t => t.name === toolUse.name)          â”‚
â”‚  2. éªŒè¯è¾“å…¥: tool.inputSchema.safeParse(input)                        â”‚
â”‚  3. æ£€æŸ¥æƒé™: canUseTool(tool, input, context)                         â”‚
â”‚  4. æ‰§è¡Œå·¥å…·: tool.call(input, context)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. Tool ç»“æœ â†’ LLM (tool_result)                                      â”‚
â”‚                                                                        â”‚
â”‚  å·¥å…·æ‰§è¡Œåï¼Œç»“æœå°è£…ä¸º tool_result æ¶ˆæ¯:                                â”‚
â”‚                                                                        â”‚
â”‚  yield createUserMessage([{                                            â”‚
â”‚    type: 'tool_result',                                                â”‚
â”‚    content: result.resultForAssistant || String(result.data),          â”‚
â”‚    tool_use_id: toolUseID,                                             â”‚
â”‚    is_error?: boolean                                                  â”‚
â”‚  }])                                                                   â”‚
â”‚                                                                        â”‚
â”‚  è¿™ä¸ªæ¶ˆæ¯ä¼šè¢«æ·»åŠ åˆ°æ¶ˆæ¯å†å²ï¼Œåœ¨ä¸‹ä¸€è½®æŸ¥è¯¢æ—¶å‘é€ç»™ LLM                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å¯ä»¥çœ‹åˆ°ï¼šClaude Code çš„å·¥å…·ç³»ç»Ÿï¼Œæœ¬è´¨ä¸Šæ˜¯å¯¹ Anthropic Tool Calling åè®®åšäº†ä¸€å±‚å·¥ç¨‹åŒ–åŒ…è£…å’Œåˆ†å±‚ã€‚**

### æ ¸å¿ƒè½¬æ¢ç‚¹

| è½¬æ¢ | è¯´æ˜ |
|:-----|:-----|
| **Zod â†’ JSON Schema** | `zodToJsonSchema(tool.inputSchema)` å°† Zod ç±»å‹è½¬ä¸º API å¯ç”¨çš„ JSON Schema |
| **æ¶ˆæ¯æ ¼å¼è½¬æ¢** | å°è£… Anthropic/OpenAI ç­‰ä¸åŒ API çš„æ¶ˆæ¯æ ¼å¼å·®å¼‚ |
| **å·¥å…·ç»“æœå°è£…** | `{ type: 'tool_result', ... }` å°†æ‰§è¡Œç»“æœè¿”å›ç»™ LLMï¼Œç»Ÿä¸€æ”¾åœ¨ user è§’è‰² |

---

## å››ã€æ–‡ä»¶è¯»å–ç±»å·¥å…·

è¿™äº›å·¥å…·å¯ä»¥ç†è§£ä¸ºï¼š**å¯¹æ–‡ä»¶ç³»ç»Ÿç›¸å…³ CLI çš„ã€Œç»“æ„åŒ–å°è£…å±‚ã€**ï¼ŒæŠŠåŸæœ¬éç»“æ„åŒ–çš„ stdout å˜æˆç¨³å®šçš„ schemaï¼Œæ–¹ä¾¿ LLM æ¶ˆåŒ–ã€‚

### 4.1 Glob â€”â€” å¿«é€Ÿæ–‡ä»¶æ¨¡å¼åŒ¹é…

**è§’è‰²ï¼š** å¯¹ `fast-glob` / `node-glob` ä¸€ç±»åº“çš„è–„å°è£…ï¼ŒæŒ‚åˆ°ç»Ÿä¸€ Tool æ¥å£ä¸‹ã€‚

```typescript
const GlobTool = {
  name: "Glob",
  description: "åŸºäº glob æ¨¡å¼å¿«é€ŸæŸ¥æ‰¾æ–‡ä»¶",
  parameters: {
    pattern: {
      type: "string",
      description: "glob æ¨¡å¼ï¼Œå¦‚ '**/*.ts' æˆ– 'src/**/*.py'"
    },
    path: {
      type: "string",
      description: "æœç´¢çš„æ ¹ç›®å½•",
      default: "."
    }
  }
}
```

**ä¸ºä»€ä¹ˆä¸ç”¨ `find` æˆ– `ls -R`ï¼Ÿ**

- **æ€§èƒ½**ï¼šé•¿ç”Ÿå‘½å‘¨æœŸè¿›ç¨‹ + å†…éƒ¨ç¼“å­˜ï¼Œé¿å…é¢‘ç¹ fork CLI
- **gitignore æ„ŸçŸ¥**ï¼šè‡ªåŠ¨è·³è¿‡ `.git`ã€`node_modules` ç­‰ç›®å½•
- **è¾“å‡ºç»“æ„åŒ–**ï¼šè¿”å›åˆ—è¡¨/JSONï¼Œè€Œä¸æ˜¯ä¸€å¨æ–‡æœ¬
- **å®‰å…¨è¾¹ç•Œ**ï¼šå—æƒé™ç³»ç»Ÿæ§åˆ¶ï¼Œé™åˆ¶å·¥ä½œç›®å½•èŒƒå›´

å…¸å‹è°ƒç”¨ï¼š

```text
Glob pattern="**/*.test.ts" path="src"
â†’ è¿”å›æ‰€æœ‰æµ‹è¯•æ–‡ä»¶åˆ—è¡¨
```

å¯ä»¥æŠŠå®ƒçœ‹æˆã€ŒæŠŠæ–‡ä»¶ç³»ç»Ÿæš´éœ²ç»™ LLM çš„ä¸€ä¸ªå—æ§è§†å›¾ã€ã€‚

---

### 4.2 Grep â€”â€” å†…å®¹æœç´¢

**è§’è‰²ï¼š** ripgrep çš„ JSON åŒ…è£…å™¨ã€‚

```typescript
const GrepTool = {
  name: "Grep",
  description: "åœ¨æ–‡ä»¶ä¸­æœç´¢åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼çš„å†…å®¹",
  parameters: {
    pattern: {
      type: "string",
      description: "æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼"
    },
    path: {
      type: "string",
      description: "æœç´¢è·¯å¾„"
    },
    include: {
      type: "array",
      description: "åŒ…å«çš„æ–‡ä»¶ç±»å‹ï¼Œå¦‚ ['*.ts', '*.py']"
    }
  }
}
```

å®ç°ä¸Šé€šå¸¸å°±æ˜¯èµ·ä¸€ä¸ª `rg` å­è¿›ç¨‹ï¼Œæ‰“å¼€ `--json` è¾“å‡ºï¼Œç„¶åæµå¼è§£æï¼š

```typescript
async function executeGrep(params: GrepParams): Promise<GrepResult> {
  const args = [
    params.pattern,
    params.path,
    '--json',               // JSON æ ¼å¼è¾“å‡º
    '--max-count', '50',    // é™åˆ¶æ¯ä¸ªæ–‡ä»¶çš„åŒ¹é…æ•°
    '--max-filesize', '1M', // è·³è¿‡å¤§æ–‡ä»¶
  ];
  
  if (params.include) {
    for (const glob of params.include) {
      args.push('--glob', glob);
    }
  }
  
  const result = await spawn('rg', args);
  return formatResults(result);
}
```

**ä¸ºä»€ä¹ˆé€‰æ‹© ripgrepï¼Ÿ** ä¸€ä¸ªå…¸å‹çš„å·¥ç¨‹å–èˆï¼š

| ç‰¹æ€§ | ripgrep | ä¼ ç»Ÿ grep |
|:-----|:--------|:----------|
| é€Ÿåº¦ | æå¿«ï¼ˆRust å®ç°ï¼‰ | ä¸€èˆ¬ |
| Unicode | é»˜è®¤æ”¯æŒ | éœ€è¦é¢å¤–é…ç½® |
| .gitignore | è‡ªåŠ¨éµå®ˆ | ä¸æ”¯æŒ |
| è¾“å‡ºæ ¼å¼ | æ”¯æŒ JSON | ä»…æ–‡æœ¬ |

æ¢å¥è¯è¯´ï¼š**ç”¨æˆç†Ÿ CLI è§£å†³ I/O å’Œæœç´¢é—®é¢˜ï¼Œç”¨ Tool å±‚è§£å†³ã€Œåè®®å’Œç»“æ„åŒ–ã€é—®é¢˜ã€‚**

---

### 4.3 Read â€”â€” æ–‡ä»¶å†…å®¹è¯»å–

**è®¾è®¡ç›®æ ‡ï¼š** å®‰å…¨ã€å¯æ§åœ°è¯»å–æ–‡ä»¶å†…å®¹ï¼Œå¹¶ä¸º LLM è¾“å‡ºåšè¿‡æ ¼å¼ä¼˜åŒ–ã€‚

```typescript
const ReadTool = {
  name: "Read",
  description: "è¯»å–æ–‡ä»¶å†…å®¹ï¼Œæ”¯æŒè¡ŒèŒƒå›´é™åˆ¶",
  parameters: {
    path: {
      type: "string",
      description: "æ–‡ä»¶è·¯å¾„"
    },
    offset: {
      type: "integer",
      description: "èµ·å§‹è¡Œå·ï¼ˆä» 0 å¼€å§‹ï¼‰",
      default: 0
    },
    limit: {
      type: "integer", 
      description: "æœ€å¤§è¯»å–è¡Œæ•°",
      default: 2000
    }
  }
}
```

```typescript
async function executeRead(params: ReadParams): Promise<string> {
  await checkReadPermission(params.path);  // æƒé™æ£€æŸ¥
  
  const stats = await fs.stat(params.path);
  if (stats.size > MAX_FILE_SIZE) {
    throw new Error('æ–‡ä»¶è¿‡å¤§ï¼Œè¯·ä½¿ç”¨ offset/limit åˆ†æ®µè¯»å–');
  }
  
  const lines = await fs.readFile(params.path, 'utf-8');
  return formatWithLineNumbers(lines, params.offset, params.limit);
}
```

è¾“å‡ºç±»ä¼¼ `cat -n`ï¼š

```text
     1  import { useState } from 'react';
     2  
     3  export function Counter() {
     4    const [count, setCount] = useState(0);
     5    return <button onClick={() => setCount(c => c + 1)}>{count}</button>;
     6  }
```

ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨ `cat` / `head` / `tail`ï¼Ÿ

- è¡Œå·æ ¼å¼å›ºå®šï¼Œæ–¹ä¾¿åç»­å¼•ç”¨ã€Œç¬¬ N è¡Œã€
- å¯¹å¤§æ–‡ä»¶å¼ºåˆ¶åˆ†é¡µï¼Œé¿å…ä¸€æ¬¡æ€§è¯»çˆ†ä¸Šä¸‹æ–‡
- æ‰€æœ‰è¯»å–éƒ½èµ°ç»Ÿä¸€æƒé™å’Œå®¡è®¡é“¾è·¯

---

### 4.4 LS â€”â€” ç›®å½•åˆ—è¡¨

```typescript
const LSTool = {
  name: "LS",
  description: "åˆ—å‡ºç›®å½•å†…å®¹",
  parameters: {
    path: {
      type: "string",
      description: "ç›®å½•è·¯å¾„"
    },
    ignore: {
      type: "array",
      description: "å¿½ç•¥çš„æ¨¡å¼",
      default: ["node_modules", ".git"]
    }
  }
}
```

è¾“å‡ºé€šå¸¸åŒ…å«ï¼š

- æ–‡ä»¶/ç›®å½•å
- ç±»å‹ï¼ˆæ–‡ä»¶/ç›®å½•/ç¬¦å·é“¾æ¥ï¼‰
- æ–‡ä»¶å¤§å°
- æœ€åä¿®æ”¹æ—¶é—´

å’Œ `ls` ç›¸æ¯”ï¼Œå®ƒæŠŠã€Œè§†å›¾ã€æŠ½è±¡æˆäº†ä¸€ä¸ªç¨³å®šçš„ JSON schemaï¼Œæ›´é€‚åˆä½œä¸º LLM çš„é•¿æœŸè®°å¿†åŸºç¡€ã€‚

---

## äº”ã€æ–‡ä»¶å†™å…¥ç±»å·¥å…·

è¿™äº›å·¥å…·æŠŠåŸæœ¬å®¹æ˜“å‡ºé”™çš„ Shell å†™å…¥æ“ä½œï¼ˆé‡å®šå‘ã€heredocã€sedï¼‰æŠ½è±¡æˆ**æ˜¾å¼æ„å›¾ + æ˜ç¡® schema**ï¼Œæ–¹ä¾¿å®¡è®¡å’Œå›æ»šã€‚

### 5.1 Write â€”â€” æ–‡ä»¶å†™å…¥

```typescript
const WriteTool = {
  name: "Write",
  description: "å°†å†…å®¹å†™å…¥æ–‡ä»¶ã€‚å¦‚æœæ–‡ä»¶å­˜åœ¨ä¼šè¢«è¦†ç›–ã€‚",
  parameters: {
    path: {
      type: "string",
      description: "ç›®æ ‡æ–‡ä»¶è·¯å¾„"
    },
    content: {
      type: "string",
      description: "è¦å†™å…¥çš„å†…å®¹"
    }
  }
}
```

å®‰å…¨æœºåˆ¶åŒ…æ‹¬ï¼š

1. å†™å…¥å‰èµ° `can_use_tool` ç­‰æƒé™æ£€æŸ¥
2. å»ºè®®é…åˆ `Read` åšã€Œè¯» â†’ æ”¹ â†’ å†™ã€çš„å®Œæ•´é“¾è·¯
3. ç”¨ä¸´æ—¶æ–‡ä»¶ + rename åšåŸå­å†™å…¥ï¼Œé¿å…åŠå†™å…¥çŠ¶æ€

**ä¸ºä»€ä¹ˆä¸ç”¨ `echo >` æˆ– heredocï¼Ÿ**

- å‡å°‘ Shell è½¬ä¹‰ç›¸å…³çš„é•¿å°¾ bug
- å¯ä»¥åšé›†ä¸­å®¡è®¡å’Œ diff
- è¡Œä¸ºå¯ä»¥ç¨³å®šåœ°åœ¨ä¸åŒç¯å¢ƒå¤ç°

---

### 5.2 Edit â€”â€” ç²¾ç¡®ç¼–è¾‘

**åœºæ™¯ï¼š** ä¸å¸Œæœ›è¦†ç›–æ•´ä¸ªæ–‡ä»¶ï¼Œè€Œæ˜¯ä¿®æ”¹æŸæ®µä¸Šä¸‹æ–‡ã€‚

```typescript
const EditTool = {
  name: "Edit",
  description: "ç¼–è¾‘æ–‡ä»¶çš„ç‰¹å®šéƒ¨åˆ†",
  parameters: {
    path: {
      type: "string",
      description: "æ–‡ä»¶è·¯å¾„"
    },
    old_string: {
      type: "string",
      description: "è¦æ›¿æ¢çš„åŸå†…å®¹"
    },
    new_string: {
      type: "string",
      description: "æ›¿æ¢åçš„æ–°å†…å®¹"
    }
  }
}
```

```typescript
async function executeEdit(params: EditParams): Promise<EditResult> {
  const content = await fs.readFile(params.path, 'utf-8');
  
  const count = (content.match(new RegExp(escapeRegex(params.old_string), 'g')) || []).length;
  
  if (count === 0) {
    throw new Error('æœªæ‰¾åˆ°è¦æ›¿æ¢çš„å†…å®¹');
  }
  if (count > 1) {
    throw new Error(`æ‰¾åˆ° ${count} å¤„åŒ¹é…ï¼Œè¯·æä¾›æ›´ç²¾ç¡®çš„ä¸Šä¸‹æ–‡`);
  }
  
  const newContent = content.replace(params.old_string, params.new_string);
  await fs.writeFile(params.path, newContent, 'utf-8');
  
  return { success: true, path: params.path };
}
```

å’Œ `sed` ç›¸æ¯”ï¼Œæ¢äº†ä¸€ç»„å·¥ç¨‹å–èˆï¼š

- è¦æ±‚ä¸Šä¸‹æ–‡å®Œå…¨åŒ¹é…ï¼Œç‰ºç‰²çµæ´»æ€§æ¢å®‰å…¨
- å¤šå¤„å‘½ä¸­ç›´æ¥æŠ¥é”™ï¼Œå¼ºè¿«è°ƒç”¨æ–¹æä¾›æ›´ç²¾ç¡®çš„ diff
- æ›´å®¹æ˜“å’Œã€Œå®¡é˜… diff â†’ æ‰¹å‡†æ‰§è¡Œã€æµæ•´åˆ

---

### 5.3 MultiEdit â€”â€” æ‰¹é‡ç¼–è¾‘

åœ¨ä¸€æ¬¡è°ƒç”¨ä¸­ï¼Œå¯¹å¤šä¸ªæ–‡ä»¶æˆ–åŒä¸€æ–‡ä»¶çš„å¤šå¤„åŒæ—¶ä¿®æ”¹ï¼š

```typescript
const MultiEditTool = {
  name: "MultiEdit",
  description: "æ‰¹é‡ç¼–è¾‘å¤šä¸ªä½ç½®",
  parameters: {
    edits: {
      type: "array",
      items: {
        type: "object",
        properties: {
          path: { type: "string" },
          old_string: { type: "string" },
          new_string: { type: "string" }
        }
      }
    }
  }
}
```

å…¸å‹ç”¨æ³•ï¼š

- æ‰¹é‡æ›´æ–° import è·¯å¾„
- é‡å‘½åæŸä¸ª hook åœ¨å¤šå¤„çš„è°ƒç”¨
- åŒæ­¥ä¿®æ”¹æ¥å£å®šä¹‰åŠå…¶æ‰€æœ‰å®ç°

å¯ä»¥è§†ä½œ Edit çš„ã€Œäº‹åŠ¡åŒ–ç‰ˆã€ã€‚

---

## å…­ã€å‘½ä»¤æ‰§è¡Œå·¥å…·

### 6.1 Bash â€”â€” Shell å‘½ä»¤æ‰§è¡Œ

**è§’è‰²å®šä½ï¼š** ä¸€ä¸ªå—æ§çš„ã€Œé€ƒç”Ÿé˜€ã€ï¼ˆescape hatchï¼‰ï¼šä¸“ç”¨å·¥å…·è¦†ç›–ä¸åˆ°çš„é•¿å°¾åœºæ™¯ï¼Œäº¤ç»™ Bash å…œåº•ã€‚

```typescript
const BashTool = {
  name: "Bash",
  description: "åœ¨æŒä¹…åŒ– Bash ä¼šè¯ä¸­æ‰§è¡Œå‘½ä»¤",
  parameters: {
    command: {
      type: "string",
      description: "è¦æ‰§è¡Œçš„å‘½ä»¤"
    },
    timeout: {
      type: "integer",
      description: "è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰",
      default: 30000
    },
    background: {
      type: "boolean",
      description: "æ˜¯å¦åœ¨åå°è¿è¡Œ",
      default: false
    }
  }
}
```

å…³é”®ç‰¹æ€§ï¼š

1. **æŒä¹…åŒ–ä¼šè¯**ï¼š`cd` ç­‰å‘½ä»¤çš„æ•ˆæœåœ¨ä¼šè¯å†…ä¿ç•™
2. **è¾“å‡ºæˆªæ–­**ï¼šå¯¹ stdout/stderr åšé•¿åº¦é™åˆ¶
3. **åå°æ‰§è¡Œ**ï¼šæ”¯æŒé•¿æ—¶é—´è¿è¡Œçš„å‘½ä»¤
4. **è¶…æ—¶æ§åˆ¶**ï¼šé¿å…å•æ¬¡è°ƒç”¨å¡æ­»ä¼šè¯

```typescript
async function executeBash(params: BashParams): Promise<BashResult> {
  if (isBlockedCommand(params.command)) {
    throw new Error('è¯¥å‘½ä»¤å·²è¢«å®‰å…¨ç­–ç•¥ç¦æ­¢');
  }
  
  await checkBashPermission(params.command);
  
  const result = await sandbox.exec(params.command, {
    timeout: params.timeout,
    background: params.background,
  });
  
  return truncateOutput(result, MAX_OUTPUT_SIZE);
}
```

**ä½•æ—¶ç”¨ Bashï¼Œä½•æ—¶ç”¨ä¸“ç”¨å·¥å…·ï¼Ÿ**

| åœºæ™¯ | æ¨èå·¥å…· |
|:-----|:---------|
| æœç´¢æ–‡ä»¶å†…å®¹ | `Grep`ï¼ˆè€Œé `bash: grep`ï¼‰ |
| æŸ¥æ‰¾æ–‡ä»¶ | `Glob`ï¼ˆè€Œé `bash: find`ï¼‰ |
| è¯»å–æ–‡ä»¶ | `Read`ï¼ˆè€Œé `bash: cat`ï¼‰ |
| å†™å…¥æ–‡ä»¶ | `Write`ï¼ˆè€Œé `bash: echo >`ï¼‰ |
| ç¼–è¾‘æ–‡ä»¶ | `Edit`ï¼ˆè€Œé `bash: sed`ï¼‰ |
| è¿è¡Œæµ‹è¯• | `Bash`ï¼ˆ`npm test` ç­‰ï¼‰ |
| Git æ“ä½œ | `Bash`ï¼ˆ`git status`, `git commit` ç­‰ï¼‰ |
| å®‰è£…ä¾èµ– | `Bash`ï¼ˆ`pip install`, `npm install` ç­‰ï¼‰ |

ä»æ¶æ„è§’åº¦çœ‹ï¼š**Bash ç”¨æ¥å¤„ç†ä¸å¯é¢„æœŸçš„é•¿å°¾ï¼›ä¸“ç”¨å·¥å…·è´Ÿè´£æŠŠé«˜é¢‘è·¯å¾„æ ‡å‡†åŒ–å’Œç»“æ„åŒ–ã€‚**

---

## ä¸ƒã€å·¥å…·ç³»ç»Ÿçš„è®¾è®¡å“²å­¦

### 7.1 ä¸“ç”¨å·¥å…· > é€šç”¨å‘½ä»¤

Claude Code çš„ä¸€ä¸ªæ˜æ˜¾å–èˆæ˜¯ï¼š**ä¸ºå¸¸è§æ“ä½œæä¾›ä¸“ç”¨å·¥å…·ï¼Œè€Œä¸æ˜¯å®Œå…¨ä¾èµ–é€šç”¨ Shell å‘½ä»¤ã€‚**

è¿™æ ·åšå¸¦æ¥å‡ ä»¶äº‹ï¼š

- è¾“å…¥/è¾“å‡º schema æ˜ç¡®ï¼Œå¯éªŒè¯ã€å¯æ¼”è¿›
- å®‰å…¨ç­–ç•¥å¯ä»¥ç²¾ç¡®åˆ°ã€ŒæŸä¸ªå·¥å…· + æŸç±»å‚æ•°ã€
- è¾“å‡ºå¯ä»¥å›´ç»•ã€Œtoken æˆæœ¬ã€å®šåˆ¶ï¼Œè€Œä¸æ˜¯è¢« CLI æ ¼å¼ç»‘æ­»
- é¿å…è½¬ä¹‰ã€locale ç­‰ Shell ç»†èŠ‚é€ æˆçš„éšæœºå¤±è´¥

è¿™å’Œå¾ˆå¤š Agent æ¡†æ¶é‡Œçš„åšæ³•ç±»ä¼¼ï¼š**å¸¸è§èƒ½åŠ›æŠ½è±¡æˆä¸€é˜¶ APIï¼ŒShell é€€åˆ°äºŒçº¿å…œåº•ã€‚**

### 7.2 æƒé™åˆ†å±‚

å·¥å…·è°ƒç”¨èµ°ä¸€æ¡å®Œæ•´çš„æƒé™é“¾ï¼š

```text
ç”¨æˆ·é…ç½® â†’ PermissionMode â†’ can_use_tool å›è°ƒ â†’ å·¥å…·æ‰§è¡Œ
           (å…¨å±€æ¡£ä½)        (ç»†ç²’åº¦æ§åˆ¶)
```

- PermissionMode å†³å®šå¤§è‡´ã€Œå¯æ“ä½œèŒƒå›´ã€ï¼ˆåªè¯» / è¯»å†™ / å…è®¸ Bashï¼‰
- `can_use_tool` å¯ä»¥æŒ‰å·¥å…·åã€è·¯å¾„ã€å‘½ä»¤å†…å®¹åšæ›´ç»†ç²’åº¦æ§åˆ¶

### 7.3 è¾“å‡ºä¼˜åŒ–

æ¯ä¸ªå·¥å…·éƒ½ä¼šå¯¹è¾“å‡ºæ¥ä¸€è½®ã€ŒLLM è§†è§’ã€çš„ç²¾ç®€ï¼š

- å°½é‡è¿”å›ç»“æ„åŒ– JSON æˆ–çº¦å®šå¥½çš„æ–‡æœ¬æ ¼å¼
- å¯¹å¤§è¾“å‡ºåšæˆªæ–­å’Œåˆ†é¡µï¼ˆRead/Grep/Bash éƒ½æœ‰ï¼‰
- æ–‡ä»¶å†…å®¹å¸¦è¡Œå·ï¼Œæ–¹ä¾¿åç»­å¼•ç”¨å’Œ diff

è¿™å…¶å®å°±æ˜¯åœ¨ã€ŒI/O å½¢çŠ¶ã€ä¸Šåšäº†å¾ˆå¤šä¸º LLM é‡èº«å®šåˆ¶çš„å·¥ä½œã€‚

---

## å…«ã€æ‰©å±•ï¼šè‡ªå®šä¹‰å·¥å…·

å†…ç½®å·¥å…·æ˜¯ä¸€å¥—ã€ŒåŸºç¡€è®¾æ–½ã€ï¼Œä½† Claude Code ä¹Ÿæ”¯æŒé€šè¿‡ **MCPï¼ˆModel Context Protocolï¼‰** æˆ–è‡ªå®šä¹‰è„šæœ¬æ‰©å±•èƒ½åŠ›ï¼š

```typescript
// é€šè¿‡ MCP æ·»åŠ è‡ªå®šä¹‰å·¥å…·
const options = {
  mcp_servers: {
    "my-tools": {
      command: "node",
      args: ["./my-mcp-server.js"],
    }
  }
};
```

å¯ä»¥ç”¨å®ƒæ¥æŒ‚æ¥ï¼š

- æ•°æ®åº“æŸ¥è¯¢å·¥å…·
- å„ç§å†…éƒ¨ HTTP API
- é¡¹ç›®ç‰¹å®šçš„æ„å»º / éƒ¨ç½² / è¿ç»´å‘½ä»¤

ä»æ¶æ„ä¸Šçœ‹ï¼Œå†…ç½®å·¥å…· + MCP å·¥å…·ï¼Œå…±åŒæ„æˆäº† Claude Code çš„ã€Œå·¥å…·å¹³é¢ã€ï¼ˆtooling planeï¼‰ã€‚

---

## ä¹ã€æ€»ç»“

ä»å®ç°å’Œåè®®ä¸¤ä¸ªå±‚é¢çœ‹ï¼ŒClaude Code çš„å·¥å…·ç³»ç»Ÿä½“ç°äº† Anthropic åœ¨ Agent è®¾è®¡ä¸Šçš„å‡ ä¸ªæ ¸å¿ƒå–å‘ï¼š

1. **ä¸“ç”¨åŒ–**ï¼šä¸ºé«˜é¢‘æ“ä½œæä¾›ä¸“ç”¨å·¥å…·ï¼ŒæŠ½è±¡å‡ºç¨³å®š APIï¼Œè€Œä¸æ˜¯è®© LLM åœ¨ Bash ä¸Šè£¸å¥”ã€‚
2. **å®‰å…¨æ€§**ï¼šå¤šå±‚æƒé™æ§åˆ¶ + æ˜ç¡®çš„è°ƒç”¨é“¾ï¼Œæ‰€æœ‰æ“ä½œéƒ½æœ‰è¿¹å¯å¾ªã€‚
3. **æ•ˆç‡ä¼˜åŒ–**ï¼šI/O å½¢çŠ¶å›´ç»• token æˆæœ¬è®¾è®¡ï¼Œæ¯”å¦‚è¡Œå·ã€åˆ†é¡µã€æˆªæ–­ã€JSON è¾“å‡ºã€‚
4. **å¯æ‰©å±•æ€§**ï¼šé€šè¿‡ MCP / è‡ªå®šä¹‰è„šæœ¬ï¼ŒæŠŠé¡¹ç›®ç§æœ‰èƒ½åŠ›ä¹Ÿçº³å…¥åŒä¸€å¥—å·¥å…·åè®®ã€‚

ä¸‹ä¸€ç¯‡ä¼šæ²¿ç€è¿™ä¸ªæŠ½è±¡ç»§ç»­å¾€ä¸‹çœ‹ï¼š**MCP åè®®æ˜¯æ€ä¹ˆæŠŠã€Œè¿œç¨‹æœåŠ¡ã€å˜æˆ Claude Code çœ¼ä¸­çš„ä¸€ä¸ªä¸ªå·¥å…·çš„ã€‚**

---

*æœ¬æ–‡åŸºäº Claude Code å…¬å¼€æ–‡æ¡£å’Œç¤¾åŒºèµ„æ–™æ•´ç†ã€‚å¦‚æœ‰é”™æ¼ï¼Œæ¬¢è¿æŒ‡æ­£ã€‚*